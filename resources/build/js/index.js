!function(n){var i={};function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,n){n(2),e.exports=n(1)},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var o={CONTENT_MAP_URL:"./resources/build/data/contentMap.xml",LOUPE_URL:"./resources/build/images/Loupe.png"};Object.freeze(o);var r={WIDTH:76,HEIGHT:100,GAP:10,SCALE:.14,SKEW:.66};Object.freeze(r);var s={MARGIN:7,MINIMUM_STEM_WIDTH:16};Object.freeze(s);var a={GRAY_CHANNEL:"190",THEME:"#48BBEE"};Object.freeze(a);var m={AUTO:"auto",BOTTOM:"bottom",LEFT:"left",NONE:"none",MARGIN_TOP:"margin-top",MIN_HEIGHT:"min-height",MIN_WIDTH:"min-width",POSITION_ABSOLUTE:"absolute",POSITION_STATIC:"static",PX:"px",RIGHT:"right",SCALE:"scale",TRANSLATE:"translate"};Object.freeze(m);var c={BOOK_PAGE_LEFT:"animationBookPageLeft",BOOK_PAGE_RIGHT:"animationBookPageRight",CONTENT_NODE_APPEND:"animationContentNodeAppend",CONTENT_NODE_REMOVE:"animationContentNodeRemove",FADE_IN:"animationFadeIn",FADE_OUT:"animationFadeOut",IMAGE_PRELOADER:"animationImagePreloader",TEXT_FIELD_DESELECT:"animationTextFieldDeselect",TEXT_FIELD_SELECT:"animationTextFieldSelect",TITLE:"animationTitle"};Object.freeze(c);var h={CONTENT_NODE:"contentNode",CONTENT_NODE_LEAF:"contentNodeLeaf",CONTENT_NODE_ROOT:"contentNodeRoot",LOUPE:"loupe",PICTURE:"picture",SUSPEND_POINTER_EVENTS:"suspendPointerEvents",TEXT_FIELD_ACTIVE:"textFieldActive",TEXT_FIELD_FOOTNOTE:"textFieldFootnote",TEXT_FIELD_WHITESPACE:"textFieldWhitespace"};Object.freeze(h);var l={BACKGROUND:"background",BOOK:"book",BRACKET:"bracket",CONTENT:"content",MASK:"mask",OUTLINE:"outline",PAGE_LEFT:"pageLeft",PAGE_RIGHT:"pageRight",SKIN:"skin",ZOOM:"zoom"};Object.freeze(l);var u={ATTRIBUTE_DOWNLOAD:"download",ATTRIBUTE_FOOTNOTE:"footnote",ATTRIBUTE_HEIGHT:"height",ATTRIBUTE_HREF:"href",ATTRIBUTE_ID:"id",ATTRIBUTE_LABEL:"label",ATTRIBUTE_URL:"url",ATTRIBUTE_WIDTH:"width",ATTRIBUTE_ZOOMABLE:"zoomable",BRANCH:"branch",LEAF:"leaf",ROOT:"root"};Object.freeze(u);var _={ANIMATION_END:"animationend",CLICK:"click",CONTEXT_MENU:"contextmenu",DRAG_START:"dragstart",KEYDOWN:"keydown",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_MOVE:"mousemove",MOUSE_WHEEL:"wheel",RESIZE:"resize",UPDATE_CONTENT:"updateContent"};Object.freeze(_);var d={ANCHOR:"a",ANCHOR_TARGET_BLANK:"_blank",ANCHOR_TARGET_SELF:"_self",CANVAS_RENDERING_CONTEXT_2D:"2d",CANVAS:"canvas",DIV:"div",IMG:"img",TYPE:"type"};Object.freeze(d);var f={CONTENT:document.getElementById("content"),ICON:document.getElementById("icon"),MAIN:document.getElementsByTagName("main")[0],TITLE:document.getElementById("title")};Object.freeze(f);var E={ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",DOWN:"Down",LEFT:"Left",RIGHT:"Right",UP:"Up"};Object.freeze(E);var T={TRANSLATION:.5,WIDTH:1};Object.freeze(T);var v={ZOOM_DEFAULT:1.5,ZOOM_INSTRUCTION:"image zoom:  mouse over and scroll or press keyboard arrows.  hold shift to accelerate.",ZOOM_MAX:4,ZOOM_STEP:.01,ZOOM_STEP_ACCELERATED:.1};function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.freeze(v);var O=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this._scale=e,this._color=t,this._init()}var e,t,i;return e=n,(t=[{key:"_init",value:function(){this._element=document.createElement(d.DIV);var e=this._element;e.id=l.BOOK,e.style.lineHeight=0,this._draw()}},{key:"_draw",value:function(){this._leftPageCanvas=document.createElement(d.CANVAS);var e=this._leftPageCanvas;e.id=l.PAGE_LEFT,e.width=r.WIDTH*this._scale,e.height=r.HEIGHT*this._scale,e.style.transformOrigin="".concat(m.RIGHT," ").concat(m.BOTTOM);var t=e.getContext(d.CANVAS_RENDERING_CONTEXT_2D);t.fillStyle=this._color,t.transform(1,r.SKEW,0,1,0,0),t.fillRect(0,0,r.WIDTH*this._scale,r.HEIGHT/2*this._scale),t.fill(),this._rightPageCanvas=document.createElement(d.CANVAS);var n=this._rightPageCanvas;n.id=l.PAGE_RIGHT,n.width=r.WIDTH*this._scale,n.height=r.HEIGHT*this._scale,n.style.transformOrigin="".concat(m.LEFT," ").concat(m.BOTTOM);var i=n.getContext(d.CANVAS_RENDERING_CONTEXT_2D);for(i.fillStyle=this._color,i.transform(1,-r.SKEW,0,1,0,r.HEIGHT/2*this._scale),i.fillRect(r.GAP*this._scale,0,r.WIDTH*this._scale,r.HEIGHT/2*this._scale),i.fill();this._element.firstChild;)this._element.removeChild(this._element.firstChild);var o=this._element;o.appendChild(e),o.appendChild(n)}},{key:"dispose",value:function(){for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element=null,this._leftPageCanvas=null,this._rightPageCanvas=null}},{key:"element",get:function(){return this._element}},{key:"scale",set:function(e){this._scale=e,this._draw()},get:function(){return this._scale}},{key:"color",set:function(e){this._color=e,this._draw()},get:function(){return this._color}}])&&p(e.prototype,t),i&&p(e,i),n}(),y={a:void 0,b:void 0,c:void 0,d:void 0,tx:void 0,ty:void 0};function N(e){var t=window.getComputedStyle(e,null).getPropertyValue("transform");if(t){var n=Object.assign({},y),i=t.replace(/^.*\((.*)\)$/g,"$1").split(/, +/).map(Number);return Object.keys(n).forEach(function(e,t){n[e]=i[t]}),n}}function L(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.seal(y);var i=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this._stemWidth=e+s.MINIMUM_STEM_WIDTH,this._stemHeight=Math.floor(t)+s.MARGIN,this._init()}var e,t,i;return e=n,(t=[{key:"_init",value:function(){this._canvas=document.createElement(d.CANVAS);var e=this._canvas;e.id=l.BRACKET,e.width=this._stemWidth+s.MARGIN+Math.ceil(T.TRANSLATION),e.height=Math.max(window.screen.width,window.screen.height),e.style.top="-".concat(s.MARGIN).concat(m.PX),e.style.left="-".concat(e.width+s.MARGIN).concat(m.PX),this._context=e.getContext(d.CANVAS_RENDERING_CONTEXT_2D);var t=this._context;t.strokeStyle=a.THEME,t.lineWidth=T.WIDTH,t.translate(T.TRANSLATION,T.TRANSLATION)}},{key:"draw",value:function(e){var t=this._context,n=t.canvas.width-Math.ceil(T.TRANSLATION);t.clearRect(0,0,t.canvas.width,t.canvas.height),t.beginPath(),t.moveTo(n,0),t.lineTo(n-s.MARGIN,0),t.lineTo(n-s.MARGIN,e+2*s.MARGIN),t.lineTo(n,e+2*s.MARGIN),t.moveTo(0,this._stemHeight),t.lineTo(this._stemWidth,this._stemHeight),this._stemHeight>e&&t.lineTo(this._stemWidth,e+2*s.MARGIN),t.stroke()}},{key:"dispose",value:function(){this._canvas=null}},{key:"element",get:function(){return this._canvas}}])&&L(e.prototype,t),i&&L(e,i),n}();function A(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var R=function(){function e(){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructor.name===e.name)throw new Error("Cannot instantiate abstract class.");this._listeners=new Map}var t,n,i;return t=e,(n=[{key:"addListener",value:function(e,t){this.hasListener(e)||this._listeners.set(e,[]),this._listeners.get(e).push(t)}},{key:"hasListener",value:function(e){return this._listeners.has(e)}},{key:"removeListener",value:function(e,t){var n;this.hasListener(e)&&(1<(n=this._listeners.get(e)).length?n.splice(n.indexOf(t),1):this._listeners.delete(e))}},{key:"dispatch",value:function(e){if(this.hasListener(e)){for(var t=this._listeners.get(e),n=arguments.length,i=new Array(1<n?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var r,s=A(t);try{for(s.s();!(r=s.n()).done;){r.value.apply(void 0,i)}}catch(e){s.e(e)}finally{s.f()}}}},{key:"dispose",value:function(){this._listeners=null}}])&&g(t.prototype,n),i&&g(t,i),e}();function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function H(e,t,n){return(H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,i,o=D(r);return t=s?(e=D(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(i=t)||"object"!==I(i)&&"function"!=typeof i?w(n):i}}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(o,R);var e,t,n,i=k(o);function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this))._url=e,n._XHRErrorHandler=n._XHRErrorHandler.bind(w(n)),n._XHRProgressHandler=n._XHRProgressHandler.bind(w(n)),n._XHRCompleteHandler=n._XHRCompleteHandler.bind(w(n)),n._xhr=new XMLHttpRequest,n._xhr.responseType=t,n}return e=o,n=[{key:"Event",get:function(){return{COMPLETE:"complete",ERROR:"error",PROGRESS:"progress"}}},{key:"ResponseType",get:function(){return{ARRAY_BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"}}}],(t=[{key:"_XHRErrorHandler",value:function(e){throw this._removeEventListeners(e.target),new Error("File Read Error")}},{key:"_XHRProgressHandler",value:function(e){H(D(o.prototype),"dispatch",this).call(this,o.Event.PROGRESS,{loaded:e.loaded,total:e.total})}},{key:"_XHRCompleteHandler",value:function(e){var t=e.target;if(this._removeEventListeners(t),404===t.status)throw new Error("File Not Found");H(D(o.prototype),"dispatch",this).call(this,o.Event.COMPLETE,{target:this,response:t.response})}},{key:"_removeEventListeners",value:function(e){e.removeEventListener(o.Event.ERROR,this._XHRErrorHandler),e.removeEventListener(o.Event.PROGRESS,this._XHRProgressHandler),e.removeEventListener("load",this._XHRCompleteHandler)}},{key:"load",value:function(){var e=this._xhr;e.addEventListener(o.Event.ERROR,this._XHRErrorHandler),e.addEventListener(o.Event.PROGRESS,this._XHRProgressHandler),e.addEventListener("load",this._XHRCompleteHandler),e.open("GET",this._url),e.send()}},{key:"abort",value:function(){this._removeEventListeners(this._xhr),this._xhr.abort()}},{key:"dispose",value:function(){this.abort(),H(D(o.prototype),"dispose",this).call(this),this._xhr=null}}])&&C(e.prototype,t),n&&C(e,n),o}();function M(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var U=function(){function f(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this._init()}var e,t,n;return e=f,n=[{key:"ZoomDirection",get:function(){return{ZOOM_IN:1,ZOOM_OUT:-1}}}],(t=[{key:"_init",value:function(){this._background=document.createElement(d.DIV),this._background.id=l.BACKGROUND,this._content=document.createElement(d.IMG),this._content.id=l.CONTENT,this._mask=document.createElement(d.DIV),this._mask.id=l.MASK,this._mask.appendChild(this._content),this._skin=document.createElement(d.IMG),this._skin.id=l.SKIN,this._zoom=document.createElement(d.DIV),this._zoom.id=l.ZOOM,this._element=document.createElement(d.DIV);var e=this._element;e.classList.add(h.LOUPE),e.appendChild(this._background),e.appendChild(this._mask),e.appendChild(this._skin),e.appendChild(this._zoom),this._skinLoader=new P(o.LOUPE_URL,P.ResponseType.BLOB),this._skinLoader.addListener(P.Event.COMPLETE,this._skinLoaderCompleteHandler.bind(this)),this._skinLoader.load()}},{key:"_skinLoaderCompleteHandler",value:function(e){var t=URL.createObjectURL(e.response);this._skin.src=t,this._skinLoader.dispose(),this._skinLoader=null}},{key:"_restoreZoom",value:function(){var e=sessionStorage.getItem(l.ZOOM);this._zoomLevel=e?Math.max(this._minimumZoom,e):Math.max(this._minimumZoom,v.ZOOM_DEFAULT),this.updateZoom(),this._isZoomRestored=!0}},{key:"updateZoom",value:function(e,t,n,i,o,r){var s,a,l,c=0<arguments.length&&void 0!==e?e:null,h=1<arguments.length&&void 0!==t?t:null,u=2<arguments.length&&void 0!==n?n:null,_=3<arguments.length&&void 0!==i?i:null,d=4<arguments.length&&void 0!==o?o:null;c&&(a=-(s=5<arguments.length&&void 0!==r&&r?v.ZOOM_STEP_ACCELERATED:v.ZOOM_STEP),l=c===f.ZoomDirection.ZOOM_IN?s:a,this._zoomLevel=Math.min(Math.max(this._minimumZoom,this._zoomLevel+=l),v.ZOOM_MAX),this.updatePosition(h,u,_,d)),this._zoom.textContent=this._zoomLevel.toFixed(2)}},{key:"updatePosition",value:function(e,t,n,i){this._skinHalfSize||(this._skinHalfSize=this._skin.clientWidth/2),this._maskOffset||(this._maskOffset=N(this._mask));var o=e/n,r=t/i,s=-(this._content.clientWidth*this._zoomLevel)*o/this._zoomLevel-this._maskOffset.tx/this._zoomLevel+this._skinHalfSize/this._zoomLevel,a=-(this._content.clientHeight*this._zoomLevel)*r/this._zoomLevel-this._maskOffset.ty/this._zoomLevel+this._skinHalfSize/this._zoomLevel;this._element.style.transform="".concat(m.TRANSLATE,"(").concat(e-this._skinHalfSize).concat(m.PX,", ").concat(t-this._skinHalfSize).concat(m.PX,")"),this._content.style.transform="".concat(m.SCALE,"(").concat(this._zoomLevel,") ").concat(m.TRANSLATE,"(").concat(s).concat(m.PX,", ").concat(a).concat(m.PX,")")}},{key:"dispose",value:function(){try{sessionStorage.setItem(l.ZOOM,this._zoomLevel)}catch(e){console.error(e)}for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element=null,this._skinLoader&&(this._skinLoader.dispose(),this._skinLoader=null),this._skin&&(URL.revokeObjectURL(this._skin.src),this._skin=null),this._background=null,this._content=null,this._mask=null,this._zoom=null,this._maskOffset=null}},{key:"element",get:function(){return this._element}},{key:"content",set:function(e){this._content.src=e,this._minimumZoom&&this._restoreZoom()}},{key:"minimumZoom",set:function(e){this._minimumZoom=e,this._content.src&&!this._isZoomRestored?this._restoreZoom():this._zoomLevel<this._minimumZoom&&(this._zoomLevel=this._minimumZoom,this.updateZoom())}}])&&M(e.prototype,t),n&&M(e,n),f}();function F(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var G=function(){function i(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this._nativeWidth=e,this._nativeHeight=t,this._grayChannel=n,this._init()}var e,t,n;return e=i,(t=[{key:"_init",value:function(){this._canvas=document.createElement(d.CANVAS);var e=this._canvas;e.id=l.MAGNIFIED_IMAGE_OUTLINE,e.width=this._nativeWidth+Math.ceil(T.TRANSLATION),e.height=this._nativeHeight+Math.ceil(T.TRANSLATION),this._context=e.getContext(d.CANVAS_RENDERING_CONTEXT_2D);var t=this._context;t.lineWidth=T.WIDTH,t.translate(T.TRANSLATION,T.TRANSLATION)}},{key:"draw",value:function(e,t){e=Math.min(e,this._nativeWidth)-T.WIDTH,t=Math.min(t,this._nativeHeight)-T.WIDTH;var n=this._context;n.clearRect(-T.TRANSLATION,-T.TRANSLATION,n.canvas.width,n.canvas.height),n.beginPath(),n.moveTo(0,0),n.lineTo(e,0),n.lineTo(e,t),n.lineTo(0,t),n.lineTo(0,0);var i=n.createLinearGradient(0,0,e,0);i.addColorStop("0","rgba(".concat(this._grayChannel,", ").concat(this._grayChannel,", ").concat(this._grayChannel,", 0)")),i.addColorStop("1","rgba(".concat(this._grayChannel,", ").concat(this._grayChannel,", ").concat(this._grayChannel,", 255)")),n.strokeStyle=i,n.stroke()}},{key:"dispose",value:function(){this._canvas=null}},{key:"element",get:function(){return this._canvas}}])&&F(e.prototype,t),n&&F(e,n),i}();function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=function(){function o(e,t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this._url=e,this._nativeWidth=t,this._nativeHeight=n,this._isZoomable=i,this._init()}var e,t,n;return e=o,(t=[{key:"_init",value:function(){this._element=document.createElement(d.DIV);var e=this._element;e.classList.add(h.PICTURE),e.style.lineHeight=0,this._isZoomable&&(this._loupe=new U,e.appendChild(this._loupe.element)),this._isLoading=!1,this._isLoaded=!1,this._fadeOutAnimationHandler=this._fadeOutAnimationHandler.bind(this),this._fadeInAnimationHandler=this._fadeInAnimationHandler.bind(this),this._outline=new G(this._nativeWidth,this._nativeHeight,a.GRAY_CHANNEL);var t=a.GRAY_CHANNEL,n="rgb(".concat(t,", ").concat(t,", ").concat(t,")");this._book=new O(r.SCALE,n),this._book.element.classList.add(c.IMAGE_PRELOADER),this._element.appendChild(this._outline.element),this._element.appendChild(this._book.element),this._contentLoader=new P(this._url,P.ResponseType.BLOB),this._contentLoader.addListener(P.Event.PROGRESS,this._contentLoaderProgressHandler.bind(this)),this._contentLoader.addListener(P.Event.COMPLETE,this._contentLoaderCompleteHandler.bind(this))}},{key:"_contentLoaderProgressHandler",value:function(e){var t=this._imageLoadProgressHeight/e.total*e.loaded;this._book.element.style.top="".concat(t).concat(m.PX)}},{key:"_contentLoaderCompleteHandler",value:function(e){var t=URL.createObjectURL(e.response);this._createContent(t),f.CONTENT.classList.add(h.SUSPEND_POINTER_EVENTS),this._element.addEventListener(_.ANIMATION_END,this._fadeOutAnimationHandler),this._element.classList.add(c.FADE_OUT),this._contentLoader.dispose(),this._contentLoader=null}},{key:"_createContent",value:function(e){this._isLoaded=!0,this._isLoading=!1,this._content=document.createElement(d.IMG);var t=this._content;t.id=l.CONTENT,t.src=e,this._contextMenuHandler=this._contextMenuHandler.bind(this),this._dragStartHandler=this._dragStartHandler.bind(this),t.addEventListener(_.CONTEXT_MENU,this._contextMenuHandler),t.addEventListener(_.DRAG_START,this._dragStartHandler),this._isZoomable&&(this._mouseEnterHandler=this._mouseEnterHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseLeaveHandler=this._mouseLeaveHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._keyDownHandler=this._keyDownHandler.bind(this),t.addEventListener(_.MOUSE_ENTER,this._mouseEnterHandler),t.addEventListener(_.MOUSE_MOVE,this._mouseMoveHandler),t.addEventListener(_.MOUSE_LEAVE,this._mouseLeaveHandler),t.addEventListener(_.MOUSE_WHEEL,this._mouseWheelHandler),this._loupe.content=e)}},{key:"_contextMenuHandler",value:function(e){e.preventDefault()}},{key:"_dragStartHandler",value:function(e){e.preventDefault()}},{key:"_mouseEnterHandler",value:function(){document.addEventListener(_.KEYDOWN,this._keyDownHandler),this._loupe.element.classList.remove(c.FADE_OUT),this._loupe.element.classList.add(c.FADE_IN),this._element.style.cursor=m.NONE}},{key:"_mouseMoveHandler",value:function(e){this._mouseX=e.clientX-this._imageOffsetX,this._mouseY=e.clientY-this._imageOffsetY,this._loupe.updatePosition(this._mouseX,this._mouseY,this._width,this._height)}},{key:"_mouseLeaveHandler",value:function(){document.removeEventListener(_.KEYDOWN,this._keyDownHandler),this._loupe.element.classList.remove(c.FADE_IN),this._loupe.element.classList.add(c.FADE_OUT),this._element.style.cursor=m.AUTO}},{key:"_mouseWheelHandler",value:function(e){e.target&&e.preventDefault();var t=e.deltaY<0?U.ZoomDirection.ZOOM_IN:U.ZoomDirection.ZOOM_OUT,n=e.shiftKey;this._loupe.updateZoom(t,this._mouseX,this._mouseY,this._width,this._height,n)}},{key:"_keyDownHandler",value:function(e){var t;switch(e.preventDefault(),e.key){case E.ARROW_UP:case E.UP:case E.ARROW_RIGHT:case E.RIGHT:t=U.ZoomDirection.ZOOM_IN;break;case E.ARROW_DOWN:case E.DOWN:case E.ARROW_LEFT:case E.LEFT:t=U.ZoomDirection.ZOOM_OUT;break;default:return}this._mouseWheelHandler({deltaY:-1*t,shiftKey:e.shiftKey})}},{key:"_fadeOutAnimationHandler",value:function(e){var t=e.target;t.removeEventListener(_.ANIMATION_END,this._fadeOutAnimationHandler),t.classList.remove(c.FADE_OUT),t.removeChild(this._outline.element),this._outline.dispose(),this._outline=null,t.removeChild(this._book.element),this._book.dispose(),this._book=null,t.appendChild(this._content),t.addEventListener(_.ANIMATION_END,this._fadeInAnimationHandler),t.classList.add(c.FADE_IN)}},{key:"_fadeInAnimationHandler",value:function(e){var t=e.target;t.removeEventListener(_.ANIMATION_END,this._fadeInAnimationHandler),t.classList.remove(c.FADE_IN),f.CONTENT.classList.remove(h.SUSPEND_POINTER_EVENTS)}},{key:"load",value:function(){this._isLoaded||(this._isLoading=!0,this._contentLoader.load())}},{key:"resize",value:function(e,t,n,i,o){var r,s,a,l=this._nativeWidth,c=this._nativeHeight;e<l||t<c?(r=e/l,s=t/c,a=Math.max(n/l,Math.min(r,s)),this._width=Math.floor(l*a),this._height=Math.floor(c*a)):(this._width=l,this._height=c,a=1),this._element.style.width="".concat(this._width).concat(m.PX),this._element.style.height="".concat(this._height).concat(m.PX),this._imageOffsetX=Math.round(i),this._imageOffsetY=Math.round(o),this._isZoomable&&(this._loupe.minimumZoom=a),this._isLoaded||(this._outline.draw(this._width,this._height),this._imageLoadProgressHeight=this._height-this._book.element.offsetHeight)}},{key:"dispose",value:function(){for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element.removeEventListener(_.ANIMATION_END,this._fadeOutAnimationHandler),this._element.removeEventListener(_.ANIMATION_END,this._fadeInAnimationHandler),this._element=null,this._contentLoader&&(this._contentLoader.dispose(),this._contentLoader=null),this._content&&(URL.revokeObjectURL(this._content.src),this._content.removeEventListener(_.CONTEXT_MENU,this._contextMenuHandler),this._content.removeEventListener(_.DRAG_START,this._dragStartHandler),this._isZoomable&&(this._content.removeEventListener(_.MOUSE_ENTER,this._mouseEnterHandler),this._content.removeEventListener(_.MOUSE_MOVE,this._mouseMoveHandler),this._content.removeEventListener(_.MOUSE_LEAVE,this._mouseLeaveHandler),this._content.removeEventListener(_.MOUSE_WHEEL,this._mouseWheelHandler),document.removeEventListener(_.KEYDOWN,this._keyDownHandler)),this._content=null),this._outline&&(this._outline.dispose(),this._outline=null),this._book&&(this._book.dispose(),this._book=null),this._loupe&&(this._loupe.dispose(),this._loupe=null)}},{key:"element",get:function(){return this._element}},{key:"isLoading",get:function(){return this._isLoading}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"isZoomable",get:function(){return this._isZoomable}}])&&W(e.prototype,t),n&&W(e,n),o}();function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function X(e,t,n){return(X="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=V(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,i,o=V(r);return t=s?(e=V(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(i=t)||"object"!==j(i)&&"function"!=typeof i?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):i}}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var K=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(a,R);var e,t,n,s=z(a);function a(e,t,n,i,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=s.call(this))._label=e,r._id=t,r._href=n,r._download=i,r._footnote=o,r._init(),r}return e=a,(t=[{key:"_init",value:function(){var e,t;this._href?(this._element=document.createElement(d.ANCHOR),(e=this._element).href=this._href,e.classList.add(h.TEXT_FIELD_ACTIVE),this._download?(e.target=d.ANCHOR_TARGET_SELF,e.download=""):e.target=d.ANCHOR_TARGET_BLANK):(this._element=document.createElement(d.DIV),t=this._element,this._id?(this._elementClickHandler=this._elementClickHandler.bind(this),t.id=this._id,t.classList.add(h.TEXT_FIELD_ACTIVE),t.addEventListener(_.CLICK,this._elementClickHandler)):this._footnote?t.classList.add(h.TEXT_FIELD_FOOTNOTE):/\S/.test(this._label)||t.classList.add(h.TEXT_FIELD_WHITESPACE)),this._element.textContent=this._label}},{key:"_elementClickHandler",value:function(){X(V(a.prototype),"dispatch",this).call(this,_.CLICK,this._id)}},{key:"dispose",value:function(){X(V(a.prototype),"dispose",this).call(this),this._element.removeEventListener(_.CLICK,this._elementClickHandler),this._element=null}},{key:"element",get:function(){return this._element}}])&&B(e.prototype,t),n&&B(e,n),a}();function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function J(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Q(e,t,n){return(Q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ne(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function te(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,i,o=ne(r);return t=s?(e=ne(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(i=t)||"object"!==Y(i)&&"function"!=typeof i?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(n):i}}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ie=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(a,R);var e,t,n,r=te(a);function a(e,t,n,i){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(o=r.call(this))._contentParentNode=e,o._bracketStemWidth=t,o._bracketStemHeight=n,o._isMobileDevice=i,o._init(),o}return e=a,(t=[{key:"_init",value:function(){if(!(this._contentParentNode instanceof Node&&this._contentParentNode.nodeType===Node.ELEMENT_NODE&&this._contentParentNode.hasChildNodes()))throw new Error("Invalid constructor argument.");var e,t=this._contentParentNode.nodeName;this._element=document.createElement(d.DIV),this._element.id=this._contentParentNode.id,this._element.setAttribute(d.TYPE,t),this._appendChildNodes(u.ATTRIBUTE_URL,this._createPicture.bind(this)),this._appendChildNodes(u.ATTRIBUTE_LABEL,this._createTextField.bind(this)),t===u.ROOT?this._element.classList.add(h.CONTENT_NODE_ROOT):(this._bracket=new i(this._bracketStemWidth,this._bracketStemHeight),this._element.appendChild(this._bracket.element),t===u.LEAF?(this._element.classList.add(h.CONTENT_NODE_LEAF),this._createLeafMutationObserver(),this._picture&&(this._picture.isZoomable&&((e=document.createElement(d.DIV)).setAttribute(u.ATTRIBUTE_LABEL,v.ZOOM_INSTRUCTION),e.setAttribute(u.ATTRIBUTE_FOOTNOTE,u.ATTRIBUTE_FOOTNOTE),this._element.appendChild(this._createTextField(e).element)),this._element.insertBefore(this._bracket.element,this._picture.element))):(this._element.classList.add(h.CONTENT_NODE),this._bracket.draw(this._elementClientRect().height)))}},{key:"_appendChildNodes",value:function(e,t){var n,i=$(this._contentParentNode.childNodes);try{for(i.s();!(n=i.n()).done;){var o,r=n.value;r.nodeType===Node.ELEMENT_NODE&&r.getAttribute(e)&&(o=t(r),this._element.appendChild(o.element))}}catch(e){i.e(e)}finally{i.f()}}},{key:"_createPicture",value:function(e){var t=e.getAttribute(u.ATTRIBUTE_URL),n=parseInt(e.getAttribute(u.ATTRIBUTE_WIDTH)),i=parseInt(e.getAttribute(u.ATTRIBUTE_HEIGHT)),o=e.getAttribute(u.ATTRIBUTE_ZOOMABLE)&&!this._isMobileDevice;return this._picture=new x(t,n,i,o),this._picture}},{key:"_createTextField",value:function(e){var t=this,n=e.getAttribute(u.ATTRIBUTE_LABEL),i=e.getAttribute(u.ATTRIBUTE_ID),o=e.getAttribute(u.ATTRIBUTE_HREF),r=e.getAttribute(u.ATTRIBUTE_DOWNLOAD),s=e.hasAttribute(u.ATTRIBUTE_FOOTNOTE);return this._textFields||(this._textFields=[]),this._textFields.unshift(new K(n,i,o,r,s)),e.hasChildNodes()&&this._textFields[0].addListener(_.CLICK,function(e){return Q(ne(a.prototype),"dispatch",t).call(t,_.UPDATE_CONTENT,e)}),this._textFields[0]}},{key:"_createLeafMutationObserver",value:function(){var i=this;this._contentParentNode.nodeName===u.LEAF&&(this._windowResizeHandler=this._windowResizeHandler.bind(this),this._containsTransformProperty=!0,this._mutationObserver=new MutationObserver(function(e){var t,n=i._picture;e[0].target.parentNode?(i._containsTransformProperty&&(t=N(i._element),i._updateLeafSize(t.tx,t.ty),i._containsTransformProperty=!1),window.addEventListener(_.RESIZE,i._windowResizeHandler),!n||n.isLoaded||n.isLoading||n.load()):(window.removeEventListener(_.RESIZE,i._windowResizeHandler),n&&n.dispose())}),this._mutationObserver.observe(this._element,{attributes:!0}))}},{key:"_elementClientRect",value:function(){var e,t=f.CONTENT;return t.contains(this._element)?e=this._element.getBoundingClientRect():(t.appendChild(this._element),e=this._element.getBoundingClientRect(),t.removeChild(this._element)),e}},{key:"_updateLeafSize",value:function(e,t){var n,i,o,r,s,a,l,c,h,u=0<arguments.length&&void 0!==e?e:0,_=1<arguments.length&&void 0!==t?t:0,d={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};this._previousViewPort&&d.width===this._previousViewPort.width&&d.height===this._previousViewPort.height||(n=this._elementClientRect(),i=parseFloat(window.getComputedStyle(f.MAIN,null).getPropertyValue(m.MARGIN_TOP)),o=d.width-n.left-i+u,r=this._picture,this._element.style.width="".concat(o).concat(m.PX),r&&(this._pictureMinWidth||(this._pictureMinWidth=parseFloat(window.getComputedStyle(r.element,null).getPropertyValue(m.MIN_WIDTH))),r.element.style.position=m.POSITION_ABSOLUTE,s=this._elementClientRect().height,a=d.height-n.top-s-i+_,r.element.style.position=m.POSITION_STATIC,l=n.left-u,c=n.top-_,r.resize(o,a,this._pictureMinWidth,l,c)),h=this._elementClientRect().height,this._bracket.draw(h),this._previousViewPort={width:d.width,height:d.height})}},{key:"_windowResizeHandler",value:function(){this._updateLeafSize()}},{key:"dispose",value:function(){for(Q(ne(a.prototype),"dispose",this).call(this);this._element.firstChild;)this._element.removeChild(this._element.firstChild);if(this._element=null,this._picture&&(this._picture.dispose(),this._picture=null),this._textFields){var e,t=$(this._textFields);try{for(t.s();!(e=t.n()).done;){e.value.dispose()}}catch(e){t.e(e)}finally{t.f()}this._textFields=null}this._bracket&&(this._bracket.dispose(),this._bracket=null),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null),window.removeEventListener(_.RESIZE,this._windowResizeHandler)}},{key:"element",get:function(){return this._element}}])&&J(e.prototype,t),n&&J(e,n),a}();function oe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return re(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"init",value:function(){this._isMobileDevice=window.navigator.userAgent.toLowerCase().includes("mobi"),this._isMobileDevice||document.addEventListener(_.KEYDOWN,function(e){switch(e.key){case E.ARROW_DOWN:case E.DOWN:case E.ARROW_LEFT:case E.LEFT:case E.ARROW_RIGHT:case E.RIGHT:case E.ARROW_UP:case E.UP:e.preventDefault()}}),this._contentNodeMap=new Map,this._dataLoaderCompleteHandler=this._dataLoaderCompleteHandler.bind(this),this._deselectAnimationEndHandler=this._deselectAnimationEndHandler.bind(this),this._removeAnimationEndHandler=this._removeAnimationEndHandler.bind(this),this._updateContentHandler=this._updateContentHandler.bind(this),this._appendContentAnimationEndHandler=this._appendContentAnimationEndHandler.bind(this),this._bookPageRightAnimationEndHandler=this._bookPageRightAnimationEndHandler.bind(this);var e=new P(o.CONTENT_MAP_URL,P.ResponseType.DOCUMENT);e.addListener(P.Event.COMPLETE,this._dataLoaderCompleteHandler),e.load()}},{key:"_dataLoaderCompleteHandler",value:function(e){e.target.removeListener(P.Event.COMPLETE,this._dataLoaderCompleteHandler),this._data=e.response;var t=new O(r.SCALE,a.THEME);f.ICON.appendChild(t.element),f.CONTENT.classList.add(h.SUSPEND_POINTER_EVENTS),this._appendContent(u.ROOT)}},{key:"_updateContentHandler",value:function(e){this._selectedTextFieldID=e,f.CONTENT.classList.add(h.SUSPEND_POINTER_EVENTS);var t=document.getElementById(this._selectedTextFieldID);t.classList.remove(h.TEXT_FIELD_ACTIVE);var n=t.parentNode;this._removeContent(n)}},{key:"_removeContent",value:function(e){if(e.getAttribute(d.TYPE)!==u.LEAF){var t,n=oe(e.childNodes);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.nodeType===Node.ELEMENT_NODE&&i.classList.contains(c.TEXT_FIELD_SELECT)){i.addEventListener(_.ANIMATION_END,this._deselectAnimationEndHandler),i.classList.remove(c.TEXT_FIELD_SELECT),i.classList.add(c.TEXT_FIELD_DESELECT);break}}}catch(e){n.e(e)}finally{n.f()}}var o;this._contentLastChild||((o=e.nextSibling)&&o.nodeType===Node.ELEMENT_NODE?(o===f.CONTENT.lastChild&&(this._contentLastChild=o),o.addEventListener(_.ANIMATION_END,this._removeAnimationEndHandler),o.classList.remove(c.CONTENT_NODE_APPEND),o.classList.add(c.CONTENT_NODE_REMOVE),this._removeContent(o)):this._appendContent(this._selectedTextFieldID))}},{key:"_deselectAnimationEndHandler",value:function(e){var t=e.target;t.removeEventListener(_.ANIMATION_END,this._deselectAnimationEndHandler),t.classList.remove(c.TEXT_FIELD_DESELECT),t.classList.remove(h.SUSPEND_POINTER_EVENTS),t.classList.add(h.TEXT_FIELD_ACTIVE)}},{key:"_removeAnimationEndHandler",value:function(e){var t=this,n=e.target;n.removeEventListener(_.ANIMATION_END,this._removeAnimationEndHandler),n.classList.remove(c.CONTENT_NODE_REMOVE),f.CONTENT.removeChild(n),this._contentLastChild===n&&(this._contentLastChild=null,setTimeout(function(){return t._appendContent(t._selectedTextFieldID)},0));var i=n.id,o=this._contentNodeMap;o.get(i).dispose(),o.delete(i)}},{key:"_appendContent",value:function(e){var t,n,i,o,r=document.getElementById(e);r&&(r.classList.add(h.SUSPEND_POINTER_EVENTS),r.classList.add(c.TEXT_FIELD_SELECT),t=r.parentElement.getAttribute(d.TYPE)===u.ROOT,n=r.clientHeight,i=t?0:r.parentElement.clientWidth-r.clientWidth,o=n*Array.from(r.parentElement.children).indexOf(r)+n/2);var s=this._data.getElementById(e),a=this._contentNodeMap;a.set(e,new ie(s,i,o,this._isMobileDevice));var l=a.get(e);l.addListener(_.UPDATE_CONTENT,this._updateContentHandler),l.element.addEventListener(_.ANIMATION_END,this._appendContentAnimationEndHandler),f.CONTENT.appendChild(l.element),e!==u.ROOT?l.element.classList.add(c.CONTENT_NODE_APPEND):this._initLaunchAnimation()}},{key:"_appendContentAnimationEndHandler",value:function(e){e.target.removeEventListener(_.ANIMATION_END,this._appendContentAnimationEndHandler),f.CONTENT.classList.remove(h.SUSPEND_POINTER_EVENTS)}},{key:"_initLaunchAnimation",value:function(){var e=document.getElementById(l.PAGE_RIGHT);e.addEventListener(_.ANIMATION_END,this._bookPageRightAnimationEndHandler),e.classList.add(c.BOOK_PAGE_RIGHT),f.TITLE.classList.add(c.TITLE)}},{key:"_bookPageRightAnimationEndHandler",value:function(e){e.target.removeEventListener(_.ANIMATION_END,this._bookPageRightAnimationEndHandler),document.getElementById(l.PAGE_LEFT).classList.add(c.BOOK_PAGE_LEFT),document.querySelector(".".concat(h.CONTENT_NODE_ROOT)).classList.add(c.CONTENT_NODE_APPEND)}}])&&se(t.prototype,n),i&&se(t,i),e}())).init()}]);