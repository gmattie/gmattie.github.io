!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){i(2),e.exports=i(1)},function(e,t,i){},function(e,t,i){"use strict";i.r(t);const s={CONTENT_MAP_URL:"./resources/build/data/contentMap.xml",LOUPE_URL:"./resources/build/images/Loupe.png"};Object.freeze(s);const n={WIDTH:76,HEIGHT:100,GAP:10,SCALE:.14,SKEW:.66};Object.freeze(n);const o={MARGIN:7,MINIMUM_STEM_WIDTH:16};Object.freeze(o);const a={GRAY_CHANNEL:"190",THEME:"#48BBEE"};Object.freeze(a);const r={AUTO:"auto",BOTTOM:"bottom",LEFT:"left",NONE:"none",MARGIN_TOP:"margin-top",MIN_HEIGHT:"min-height",MIN_WIDTH:"min-width",POSITION_ABSOLUTE:"absolute",POSITION_STATIC:"static",PX:"px",RIGHT:"right",SCALE:"scale",TRANSLATE:"translate"};Object.freeze(r);const h={BOOK_PAGE_LEFT:"animationBookPageLeft",BOOK_PAGE_RIGHT:"animationBookPageRight",CONTENT_NODE_APPEND:"animationContentNodeAppend",CONTENT_NODE_REMOVE:"animationContentNodeRemove",FADE_IN:"animationFadeIn",FADE_OUT:"animationFadeOut",IMAGE_PRELOADER:"animationImagePreloader",TEXT_FIELD_DESELECT:"animationTextFieldDeselect",TEXT_FIELD_SELECT:"animationTextFieldSelect",TITLE:"animationTitle"};Object.freeze(h);const _={CONTENT_NODE:"contentNode",CONTENT_NODE_LEAF:"contentNodeLeaf",CONTENT_NODE_ROOT:"contentNodeRoot",LOUPE:"loupe",PICTURE:"picture",SUSPEND_POINTER_EVENTS:"suspendPointerEvents",TEXT_FIELD_ACTIVE:"textFieldActive",TEXT_FIELD_FOOTNOTE:"textFieldFootnote",TEXT_FIELD_WHITESPACE:"textFieldWhitespace"};Object.freeze(_);const l={BACKGROUND:"background",BOOK:"book",BRACKET:"bracket",CONTENT:"content",MASK:"mask",OUTLINE:"outline",PAGE_LEFT:"pageLeft",PAGE_RIGHT:"pageRight",SKIN:"skin",ZOOM:"zoom"};Object.freeze(l);const d={ATTRIBUTE_DOWNLOAD:"download",ATTRIBUTE_FOOTNOTE:"footnote",ATTRIBUTE_HEIGHT:"height",ATTRIBUTE_HREF:"href",ATTRIBUTE_ID:"id",ATTRIBUTE_LABEL:"label",ATTRIBUTE_URL:"url",ATTRIBUTE_WIDTH:"width",ATTRIBUTE_ZOOMABLE:"zoomable",BRANCH:"branch",LEAF:"leaf",ROOT:"root"};Object.freeze(d);const E={ANIMATION_END:"animationend",CLICK:"click",CONTEXT_MENU:"contextmenu",DRAG_START:"dragstart",KEYDOWN:"keydown",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_MOVE:"mousemove",MOUSE_WHEEL:"wheel",RESIZE:"resize",UPDATE_CONTENT:"updateContent"};Object.freeze(E);const c={ANCHOR:"a",ANCHOR_TARGET_BLANK:"_blank",ANCHOR_TARGET_SELF:"_self",CANVAS_RENDERING_CONTEXT_2D:"2d",CANVAS:"canvas",DIV:"div",IMG:"img",TYPE:"type"};Object.freeze(c);const m={CONTENT:document.getElementById("content"),ICON:document.getElementById("icon"),MAIN:document.getElementsByTagName("main")[0],TITLE:document.getElementById("title")};Object.freeze(m);const T={ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",DOWN:"Down",LEFT:"Left",RIGHT:"Right",UP:"Up"};Object.freeze(T);const O={TRANSLATION:.5,WIDTH:1};Object.freeze(O);const u={ZOOM_DEFAULT:1.5,ZOOM_INSTRUCTION:"image zoom:  mouse over and scroll or press keyboard arrows.  hold shift to accelerate.",ZOOM_MAX:4,ZOOM_STEP:.01,ZOOM_STEP_ACCELERATED:.1};Object.freeze(u);var N=class{constructor(e,t){this._scale=e,this._color=t,this._init()}_init(){this._element=document.createElement(c.DIV);const e=this._element;e.id=l.BOOK,e.style.lineHeight=0,this._draw()}_draw(){this._leftPageCanvas=document.createElement(c.CANVAS);const e=this._leftPageCanvas;e.id=l.PAGE_LEFT,e.width=n.WIDTH*this._scale,e.height=n.HEIGHT*this._scale,e.style.transformOrigin=`${r.RIGHT} ${r.BOTTOM}`;const t=e.getContext(c.CANVAS_RENDERING_CONTEXT_2D);t.fillStyle=this._color,t.transform(1,n.SKEW,0,1,0,0),t.fillRect(0,0,n.WIDTH*this._scale,n.HEIGHT/2*this._scale),t.fill(),this._rightPageCanvas=document.createElement(c.CANVAS);const i=this._rightPageCanvas;i.id=l.PAGE_RIGHT,i.width=n.WIDTH*this._scale,i.height=n.HEIGHT*this._scale,i.style.transformOrigin=`${r.LEFT} ${r.BOTTOM}`;const s=i.getContext(c.CANVAS_RENDERING_CONTEXT_2D);for(s.fillStyle=this._color,s.transform(1,-n.SKEW,0,1,0,n.HEIGHT/2*this._scale),s.fillRect(n.GAP*this._scale,0,n.WIDTH*this._scale,n.HEIGHT/2*this._scale),s.fill();this._element.firstChild;)this._element.removeChild(this._element.firstChild);const o=this._element;o.appendChild(e),o.appendChild(i)}dispose(){for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element=null,this._leftPageCanvas=null,this._rightPageCanvas=null}get element(){return this._element}set scale(e){this._scale=e,this._draw()}get scale(){return this._scale}set color(e){this._color=e,this._draw()}get color(){return this._color}};const L={a:void 0,b:void 0,c:void 0,d:void 0,tx:void 0,ty:void 0};function A(e){const t=window.getComputedStyle(e,null).getPropertyValue("transform");if(t){const e=Object.assign({},L),i=t.replace(/^.*\((.*)\)$/g,"$1").split(/, +/).map(Number);return Object.keys(e).forEach(((t,s)=>{e[t]=i[s]})),e}}Object.seal(L);var p=class{constructor(e,t){this._stemWidth=e+o.MINIMUM_STEM_WIDTH,this._stemHeight=Math.floor(t)+o.MARGIN,this._init()}_init(){this._canvas=document.createElement(c.CANVAS);const e=this._canvas;e.id=l.BRACKET,e.width=this._stemWidth+o.MARGIN+Math.ceil(O.TRANSLATION),e.height=Math.max(window.screen.width,window.screen.height),e.style.top=`-${o.MARGIN}${r.PX}`,e.style.left=`-${e.width+o.MARGIN}${r.PX}`,this._context=e.getContext(c.CANVAS_RENDERING_CONTEXT_2D);const t=this._context;t.strokeStyle=a.THEME,t.lineWidth=O.WIDTH,t.translate(O.TRANSLATION,O.TRANSLATION)}draw(e){const t=this._context,i=t.canvas.width-Math.ceil(O.TRANSLATION);t.clearRect(0,0,t.canvas.width,t.canvas.height),t.beginPath(),t.moveTo(i,0),t.lineTo(i-o.MARGIN,0),t.lineTo(i-o.MARGIN,e+2*o.MARGIN),t.lineTo(i,e+2*o.MARGIN),t.moveTo(0,this._stemHeight),t.lineTo(this._stemWidth,this._stemHeight),this._stemHeight>e&&t.lineTo(this._stemWidth,e+2*o.MARGIN),t.stroke()}dispose(){this._canvas=null}get element(){return this._canvas}};class I{constructor(){if(this.constructor.name===I.name)throw new Error("Cannot instantiate abstract class.");this._listeners=new Map}addListener(e,t){this.hasListener(e)||this._listeners.set(e,[]),this._listeners.get(e).push(t)}hasListener(e){return this._listeners.has(e)}removeListener(e,t){if(this.hasListener(e)){const i=this._listeners.get(e);i.length>1?i.splice(i.indexOf(t),1):this._listeners.delete(e)}}dispatch(e,...t){if(this.hasListener(e)){const i=this._listeners.get(e);for(const e of i)e(...t)}}dispose(){this._listeners=null}}var R=I;class v extends R{constructor(e,t){super(),this._url=e,this._XHRErrorHandler=this._XHRErrorHandler.bind(this),this._XHRProgressHandler=this._XHRProgressHandler.bind(this),this._XHRCompleteHandler=this._XHRCompleteHandler.bind(this),this._xhr=new XMLHttpRequest,this._xhr.responseType=t}_XHRErrorHandler(e){throw this._removeEventListeners(e.target),new Error("File Read Error")}_XHRProgressHandler(e){super.dispatch(v.Event.PROGRESS,{loaded:e.loaded,total:e.total})}_XHRCompleteHandler(e){const t=e.target;if(this._removeEventListeners(t),404===t.status)throw new Error("File Not Found");super.dispatch(v.Event.COMPLETE,{target:this,response:t.response})}_removeEventListeners(e){e.removeEventListener(v.Event.ERROR,this._XHRErrorHandler),e.removeEventListener(v.Event.PROGRESS,this._XHRProgressHandler),e.removeEventListener("load",this._XHRCompleteHandler)}load(){const e=this._xhr;e.addEventListener(v.Event.ERROR,this._XHRErrorHandler),e.addEventListener(v.Event.PROGRESS,this._XHRProgressHandler),e.addEventListener("load",this._XHRCompleteHandler),e.open("GET",this._url),e.send()}abort(){this._removeEventListeners(this._xhr),this._xhr.abort()}dispose(){this.abort(),super.dispose(),this._xhr=null}static get Event(){return{COMPLETE:"complete",ERROR:"error",PROGRESS:"progress"}}static get ResponseType(){return{ARRAY_BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"}}}var C=v;class H{constructor(){this._init()}_init(){this._background=document.createElement(c.DIV),this._background.id=l.BACKGROUND,this._content=document.createElement(c.IMG),this._content.id=l.CONTENT,this._mask=document.createElement(c.DIV),this._mask.id=l.MASK,this._mask.appendChild(this._content),this._skin=document.createElement(c.IMG),this._skin.id=l.SKIN,this._zoom=document.createElement(c.DIV),this._zoom.id=l.ZOOM,this._element=document.createElement(c.DIV);const e=this._element;e.classList.add(_.LOUPE),e.appendChild(this._background),e.appendChild(this._mask),e.appendChild(this._skin),e.appendChild(this._zoom),this._skinLoader=new C(s.LOUPE_URL,C.ResponseType.BLOB),this._skinLoader.addListener(C.Event.COMPLETE,this._skinLoaderCompleteHandler.bind(this)),this._skinLoader.load()}_skinLoaderCompleteHandler(e){const t=URL.createObjectURL(e.response);this._skin.src=t,this._skinLoader.dispose(),this._skinLoader=null}_restoreZoom(){const e=sessionStorage.getItem(l.ZOOM);this._zoomLevel=e?Math.max(this._minimumZoom,e):Math.max(this._minimumZoom,u.ZOOM_DEFAULT),this.updateZoom(),this._isZoomRestored=!0}updateZoom(e=null,t=null,i=null,s=null,n=null,o=!1){if(e){const a=o?u.ZOOM_STEP_ACCELERATED:u.ZOOM_STEP,r=-a,h=e===H.ZoomDirection.ZOOM_IN?a:r;this._zoomLevel=Math.min(Math.max(this._minimumZoom,this._zoomLevel+=h),u.ZOOM_MAX),this.updatePosition(t,i,s,n)}this._zoom.textContent=this._zoomLevel.toFixed(2)}updatePosition(e,t,i,s){this._skinHalfSize||(this._skinHalfSize=this._skin.clientWidth/2),this._maskOffset||(this._maskOffset=A(this._mask));const n=e/i,o=t/s,a=-this._content.clientWidth*this._zoomLevel*n/this._zoomLevel-this._maskOffset.tx/this._zoomLevel+this._skinHalfSize/this._zoomLevel,h=-this._content.clientHeight*this._zoomLevel*o/this._zoomLevel-this._maskOffset.ty/this._zoomLevel+this._skinHalfSize/this._zoomLevel;this._element.style.transform=`${r.TRANSLATE}(${e-this._skinHalfSize}${r.PX}, ${t-this._skinHalfSize}${r.PX})`,this._content.style.transform=`${r.SCALE}(${this._zoomLevel}) ${r.TRANSLATE}(${a}${r.PX}, ${h}${r.PX})`}dispose(){try{sessionStorage.setItem(l.ZOOM,this._zoomLevel)}catch(e){console.error(e)}for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element=null,this._skinLoader&&(this._skinLoader.dispose(),this._skinLoader=null),this._skin&&(URL.revokeObjectURL(this._skin.src),this._skin=null),this._background=null,this._content=null,this._mask=null,this._zoom=null,this._maskOffset=null}get element(){return this._element}set content(e){this._content.src=e,this._minimumZoom&&this._restoreZoom()}set minimumZoom(e){this._minimumZoom=e,this._content.src&&!this._isZoomRestored?this._restoreZoom():this._zoomLevel<this._minimumZoom&&(this._zoomLevel=this._minimumZoom,this.updateZoom())}static get ZoomDirection(){return{ZOOM_IN:1,ZOOM_OUT:-1}}}var g=H;var f=class{constructor(e,t,i){this._nativeWidth=e,this._nativeHeight=t,this._grayChannel=i,this._init()}_init(){this._canvas=document.createElement(c.CANVAS);const e=this._canvas;e.id=l.MAGNIFIED_IMAGE_OUTLINE,e.width=this._nativeWidth+Math.ceil(O.TRANSLATION),e.height=this._nativeHeight+Math.ceil(O.TRANSLATION),this._context=e.getContext(c.CANVAS_RENDERING_CONTEXT_2D);const t=this._context;t.lineWidth=O.WIDTH,t.translate(O.TRANSLATION,O.TRANSLATION)}draw(e,t){e=Math.min(e,this._nativeWidth)-O.WIDTH,t=Math.min(t,this._nativeHeight)-O.WIDTH;const i=this._context;i.clearRect(-O.TRANSLATION,-O.TRANSLATION,i.canvas.width,i.canvas.height),i.beginPath(),i.moveTo(0,0),i.lineTo(e,0),i.lineTo(e,t),i.lineTo(0,t),i.lineTo(0,0);const s=i.createLinearGradient(0,0,e,0);s.addColorStop("0",`rgba(${this._grayChannel}, ${this._grayChannel}, ${this._grayChannel}, 0)`),s.addColorStop("1",`rgba(${this._grayChannel}, ${this._grayChannel}, ${this._grayChannel}, 255)`),i.strokeStyle=s,i.stroke()}dispose(){this._canvas=null}get element(){return this._canvas}};var D=class{constructor(e,t,i,s){this._url=e,this._nativeWidth=t,this._nativeHeight=i,this._isZoomable=s,this._init()}_init(){this._element=document.createElement(c.DIV);const e=this._element;e.classList.add(_.PICTURE),e.style.lineHeight=0,this._isZoomable&&(this._loupe=new g,e.appendChild(this._loupe.element)),this._isLoading=!1,this._isLoaded=!1,this._fadeOutAnimationHandler=this._fadeOutAnimationHandler.bind(this),this._fadeInAnimationHandler=this._fadeInAnimationHandler.bind(this),this._outline=new f(this._nativeWidth,this._nativeHeight,a.GRAY_CHANNEL);const t=a.GRAY_CHANNEL,i=`rgb(${t}, ${t}, ${t})`;this._book=new N(n.SCALE,i),this._book.element.classList.add(h.IMAGE_PRELOADER),this._element.appendChild(this._outline.element),this._element.appendChild(this._book.element),this._contentLoader=new C(this._url,C.ResponseType.BLOB),this._contentLoader.addListener(C.Event.PROGRESS,this._contentLoaderProgressHandler.bind(this)),this._contentLoader.addListener(C.Event.COMPLETE,this._contentLoaderCompleteHandler.bind(this))}_contentLoaderProgressHandler(e){const t=this._imageLoadProgressHeight/e.total*e.loaded;this._book.element.style.top=`${t}${r.PX}`}_contentLoaderCompleteHandler(e){const t=URL.createObjectURL(e.response);this._createContent(t),m.CONTENT.classList.add(_.SUSPEND_POINTER_EVENTS),this._element.addEventListener(E.ANIMATION_END,this._fadeOutAnimationHandler),this._element.classList.add(h.FADE_OUT),this._contentLoader.dispose(),this._contentLoader=null}_createContent(e){this._isLoaded=!0,this._isLoading=!1,this._content=document.createElement(c.IMG);const t=this._content;t.id=l.CONTENT,t.src=e,this._contextMenuHandler=this._contextMenuHandler.bind(this),this._dragStartHandler=this._dragStartHandler.bind(this),t.addEventListener(E.CONTEXT_MENU,this._contextMenuHandler),t.addEventListener(E.DRAG_START,this._dragStartHandler),this._isZoomable&&(this._mouseEnterHandler=this._mouseEnterHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseLeaveHandler=this._mouseLeaveHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._keyDownHandler=this._keyDownHandler.bind(this),t.addEventListener(E.MOUSE_ENTER,this._mouseEnterHandler),t.addEventListener(E.MOUSE_MOVE,this._mouseMoveHandler),t.addEventListener(E.MOUSE_LEAVE,this._mouseLeaveHandler),t.addEventListener(E.MOUSE_WHEEL,this._mouseWheelHandler),this._loupe.content=e)}_contextMenuHandler(e){e.preventDefault()}_dragStartHandler(e){e.preventDefault()}_mouseEnterHandler(){document.addEventListener(E.KEYDOWN,this._keyDownHandler),this._loupe.element.classList.remove(h.FADE_OUT),this._loupe.element.classList.add(h.FADE_IN),this._element.style.cursor=r.NONE}_mouseMoveHandler(e){this._mouseX=e.clientX-this._imageOffsetX,this._mouseY=e.clientY-this._imageOffsetY,this._loupe.updatePosition(this._mouseX,this._mouseY,this._width,this._height)}_mouseLeaveHandler(){document.removeEventListener(E.KEYDOWN,this._keyDownHandler),this._loupe.element.classList.remove(h.FADE_IN),this._loupe.element.classList.add(h.FADE_OUT),this._element.style.cursor=r.AUTO}_mouseWheelHandler(e){e.target&&e.preventDefault();const t=e.deltaY<0?g.ZoomDirection.ZOOM_IN:g.ZoomDirection.ZOOM_OUT,i=e.shiftKey;this._loupe.updateZoom(t,this._mouseX,this._mouseY,this._width,this._height,i)}_keyDownHandler(e){let t;switch(e.preventDefault(),e.key){case T.ARROW_UP:case T.UP:case T.ARROW_RIGHT:case T.RIGHT:t=g.ZoomDirection.ZOOM_IN;break;case T.ARROW_DOWN:case T.DOWN:case T.ARROW_LEFT:case T.LEFT:t=g.ZoomDirection.ZOOM_OUT;break;default:return}this._mouseWheelHandler({deltaY:-1*t,shiftKey:e.shiftKey})}_fadeOutAnimationHandler(e){const t=e.target;t.removeEventListener(E.ANIMATION_END,this._fadeOutAnimationHandler),t.classList.remove(h.FADE_OUT),t.removeChild(this._outline.element),this._outline.dispose(),this._outline=null,t.removeChild(this._book.element),this._book.dispose(),this._book=null,t.appendChild(this._content),t.addEventListener(E.ANIMATION_END,this._fadeInAnimationHandler),t.classList.add(h.FADE_IN)}_fadeInAnimationHandler(e){const t=e.target;t.removeEventListener(E.ANIMATION_END,this._fadeInAnimationHandler),t.classList.remove(h.FADE_IN),m.CONTENT.classList.remove(_.SUSPEND_POINTER_EVENTS)}load(){this._isLoaded||(this._isLoading=!0,this._contentLoader.load())}resize(e,t,i,s,n){const o=this._nativeWidth,a=this._nativeHeight;let h;if(e<o||t<a){const s=e/o,n=t/a;h=Math.max(i/o,Math.min(s,n)),this._width=Math.floor(o*h),this._height=Math.floor(a*h)}else this._width=o,this._height=a,h=1;this._element.style.width=`${this._width}${r.PX}`,this._element.style.height=`${this._height}${r.PX}`,this._imageOffsetX=Math.round(s),this._imageOffsetY=Math.round(n),this._isZoomable&&(this._loupe.minimumZoom=h),this._isLoaded||(this._outline.draw(this._width,this._height),this._imageLoadProgressHeight=this._height-this._book.element.offsetHeight)}dispose(){for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element.removeEventListener(E.ANIMATION_END,this._fadeOutAnimationHandler),this._element.removeEventListener(E.ANIMATION_END,this._fadeInAnimationHandler),this._element=null,this._contentLoader&&(this._contentLoader.dispose(),this._contentLoader=null),this._content&&(URL.revokeObjectURL(this._content.src),this._content.removeEventListener(E.CONTEXT_MENU,this._contextMenuHandler),this._content.removeEventListener(E.DRAG_START,this._dragStartHandler),this._isZoomable&&(this._content.removeEventListener(E.MOUSE_ENTER,this._mouseEnterHandler),this._content.removeEventListener(E.MOUSE_MOVE,this._mouseMoveHandler),this._content.removeEventListener(E.MOUSE_LEAVE,this._mouseLeaveHandler),this._content.removeEventListener(E.MOUSE_WHEEL,this._mouseWheelHandler),document.removeEventListener(E.KEYDOWN,this._keyDownHandler)),this._content=null),this._outline&&(this._outline.dispose(),this._outline=null),this._book&&(this._book.dispose(),this._book=null),this._loupe&&(this._loupe.dispose(),this._loupe=null)}get element(){return this._element}get isLoading(){return this._isLoading}get isLoaded(){return this._isLoaded}get isZoomable(){return this._isZoomable}};var M=class extends R{constructor(e,t,i,s,n){super(),this._label=e,this._id=t,this._href=i,this._download=s,this._footnote=n,this._init()}_init(){if(this._href){this._element=document.createElement(c.ANCHOR);const e=this._element;e.href=this._href,e.classList.add(_.TEXT_FIELD_ACTIVE),this._download?(e.target=c.ANCHOR_TARGET_SELF,e.download=""):e.target=c.ANCHOR_TARGET_BLANK}else{this._element=document.createElement(c.DIV);const e=this._element;this._id?(this._elementClickHandler=this._elementClickHandler.bind(this),e.id=this._id,e.classList.add(_.TEXT_FIELD_ACTIVE),e.addEventListener(E.CLICK,this._elementClickHandler)):this._footnote?e.classList.add(_.TEXT_FIELD_FOOTNOTE):/\S/.test(this._label)||e.classList.add(_.TEXT_FIELD_WHITESPACE)}this._element.textContent=this._label}_elementClickHandler(){super.dispatch(E.CLICK,this._id)}dispose(){super.dispose(),this._element.removeEventListener(E.CLICK,this._elementClickHandler),this._element=null}get element(){return this._element}};var b=class extends R{constructor(e,t,i,s){super(),this._contentParentNode=e,this._bracketStemWidth=t,this._bracketStemHeight=i,this._isMobileDevice=s,this._init()}_init(){if(!(this._contentParentNode instanceof Node&&this._contentParentNode.nodeType===Node.ELEMENT_NODE&&this._contentParentNode.hasChildNodes()))throw new Error("Invalid constructor argument.");{const e=this._contentParentNode.nodeName;if(this._element=document.createElement(c.DIV),this._element.id=this._contentParentNode.id,this._element.setAttribute(c.TYPE,e),this._appendChildNodes(d.ATTRIBUTE_URL,this._createPicture.bind(this)),this._appendChildNodes(d.ATTRIBUTE_LABEL,this._createTextField.bind(this)),e===d.ROOT)this._element.classList.add(_.CONTENT_NODE_ROOT);else if(this._bracket=new p(this._bracketStemWidth,this._bracketStemHeight),this._element.appendChild(this._bracket.element),e===d.LEAF){if(this._element.classList.add(_.CONTENT_NODE_LEAF),this._createLeafMutationObserver(),this._picture){if(this._picture.isZoomable){const e=document.createElement(c.DIV);e.setAttribute(d.ATTRIBUTE_LABEL,u.ZOOM_INSTRUCTION),e.setAttribute(d.ATTRIBUTE_FOOTNOTE,d.ATTRIBUTE_FOOTNOTE),this._element.appendChild(this._createTextField(e).element)}this._element.insertBefore(this._bracket.element,this._picture.element)}}else this._element.classList.add(_.CONTENT_NODE),this._bracket.draw(this._elementClientRect().height)}}_appendChildNodes(e,t){const i=this._contentParentNode.childNodes;for(const s of i)if(s.nodeType===Node.ELEMENT_NODE&&s.getAttribute(e)){const e=t(s);this._element.appendChild(e.element)}}_createPicture(e){const t=e.getAttribute(d.ATTRIBUTE_URL),i=parseInt(e.getAttribute(d.ATTRIBUTE_WIDTH)),s=parseInt(e.getAttribute(d.ATTRIBUTE_HEIGHT)),n=e.getAttribute(d.ATTRIBUTE_ZOOMABLE)&&!this._isMobileDevice;return this._picture=new D(t,i,s,n),this._picture}_createTextField(e){const t=e.getAttribute(d.ATTRIBUTE_LABEL),i=e.getAttribute(d.ATTRIBUTE_ID),s=e.getAttribute(d.ATTRIBUTE_HREF),n=e.getAttribute(d.ATTRIBUTE_DOWNLOAD),o=e.hasAttribute(d.ATTRIBUTE_FOOTNOTE);return this._textFields||(this._textFields=[]),this._textFields.unshift(new M(t,i,s,n,o)),e.hasChildNodes()&&this._textFields[0].addListener(E.CLICK,(e=>super.dispatch(E.UPDATE_CONTENT,e))),this._textFields[0]}_createLeafMutationObserver(){this._contentParentNode.nodeName===d.LEAF&&(this._windowResizeHandler=this._windowResizeHandler.bind(this),this._containsTransformProperty=!0,this._mutationObserver=new MutationObserver((e=>{const t=this._picture;if(e[0].target.parentNode){if(this._containsTransformProperty){const e=A(this._element);this._updateLeafSize(e.tx,e.ty),this._containsTransformProperty=!1}window.addEventListener(E.RESIZE,this._windowResizeHandler),!t||t.isLoaded||t.isLoading||t.load()}else window.removeEventListener(E.RESIZE,this._windowResizeHandler),t&&t.dispose()})),this._mutationObserver.observe(this._element,{attributes:!0}))}_elementClientRect(){const e=m.CONTENT;let t;return e.contains(this._element)?t=this._element.getBoundingClientRect():(e.appendChild(this._element),t=this._element.getBoundingClientRect(),e.removeChild(this._element)),t}_updateLeafSize(e=0,t=0){const i={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};if(this._previousViewPort&&i.width===this._previousViewPort.width&&i.height===this._previousViewPort.height)return;const s=this._elementClientRect(),n=parseFloat(window.getComputedStyle(m.MAIN,null).getPropertyValue(r.MARGIN_TOP)),o=i.width-s.left-n+e,a=this._picture;if(this._element.style.width=`${o}${r.PX}`,a){this._pictureMinWidth||(this._pictureMinWidth=parseFloat(window.getComputedStyle(a.element,null).getPropertyValue(r.MIN_WIDTH))),a.element.style.position=r.POSITION_ABSOLUTE;const h=this._elementClientRect().height,_=i.height-s.top-h-n+t;a.element.style.position=r.POSITION_STATIC;const l=s.left-e,d=s.top-t;a.resize(o,_,this._pictureMinWidth,l,d)}const h=this._elementClientRect().height;this._bracket.draw(h),this._previousViewPort={width:i.width,height:i.height}}_windowResizeHandler(){this._updateLeafSize()}dispose(){for(super.dispose();this._element.firstChild;)this._element.removeChild(this._element.firstChild);if(this._element=null,this._picture&&(this._picture.dispose(),this._picture=null),this._textFields){for(let e of this._textFields)e.dispose();this._textFields=null}this._bracket&&(this._bracket.dispose(),this._bracket=null),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null),window.removeEventListener(E.RESIZE,this._windowResizeHandler)}get element(){return this._element}};(new class{init(){this._isMobileDevice=window.navigator.userAgent.toLowerCase().includes("mobi"),this._isMobileDevice||document.addEventListener(E.KEYDOWN,(e=>{switch(e.key){case T.ARROW_DOWN:case T.DOWN:case T.ARROW_LEFT:case T.LEFT:case T.ARROW_RIGHT:case T.RIGHT:case T.ARROW_UP:case T.UP:e.preventDefault()}})),this._contentNodeMap=new Map,this._dataLoaderCompleteHandler=this._dataLoaderCompleteHandler.bind(this),this._deselectAnimationEndHandler=this._deselectAnimationEndHandler.bind(this),this._removeAnimationEndHandler=this._removeAnimationEndHandler.bind(this),this._updateContentHandler=this._updateContentHandler.bind(this),this._appendContentAnimationEndHandler=this._appendContentAnimationEndHandler.bind(this),this._bookPageRightAnimationEndHandler=this._bookPageRightAnimationEndHandler.bind(this);const e=new C(s.CONTENT_MAP_URL,C.ResponseType.DOCUMENT);e.addListener(C.Event.COMPLETE,this._dataLoaderCompleteHandler),e.load()}_dataLoaderCompleteHandler(e){e.target.removeListener(C.Event.COMPLETE,this._dataLoaderCompleteHandler),this._data=e.response;const t=new N(n.SCALE,a.THEME);m.ICON.appendChild(t.element),m.CONTENT.classList.add(_.SUSPEND_POINTER_EVENTS),this._appendContent(d.ROOT)}_updateContentHandler(e){this._selectedTextFieldID=e,m.CONTENT.classList.add(_.SUSPEND_POINTER_EVENTS);const t=document.getElementById(this._selectedTextFieldID);t.classList.remove(_.TEXT_FIELD_ACTIVE);const i=t.parentNode;this._removeContent(i)}_removeContent(e){if(e.getAttribute(c.TYPE)!==d.LEAF){const t=e.childNodes;for(const e of t)if(e.nodeType===Node.ELEMENT_NODE&&e.classList.contains(h.TEXT_FIELD_SELECT)){e.addEventListener(E.ANIMATION_END,this._deselectAnimationEndHandler),e.classList.remove(h.TEXT_FIELD_SELECT),e.classList.add(h.TEXT_FIELD_DESELECT);break}}if(!this._contentLastChild){const t=e.nextSibling;t&&t.nodeType===Node.ELEMENT_NODE?(t===m.CONTENT.lastChild&&(this._contentLastChild=t),t.addEventListener(E.ANIMATION_END,this._removeAnimationEndHandler),t.classList.remove(h.CONTENT_NODE_APPEND),t.classList.add(h.CONTENT_NODE_REMOVE),this._removeContent(t)):this._appendContent(this._selectedTextFieldID)}}_deselectAnimationEndHandler(e){const t=e.target;t.removeEventListener(E.ANIMATION_END,this._deselectAnimationEndHandler),t.classList.remove(h.TEXT_FIELD_DESELECT),t.classList.remove(_.SUSPEND_POINTER_EVENTS),t.classList.add(_.TEXT_FIELD_ACTIVE)}_removeAnimationEndHandler(e){const t=e.target;t.removeEventListener(E.ANIMATION_END,this._removeAnimationEndHandler),t.classList.remove(h.CONTENT_NODE_REMOVE),m.CONTENT.removeChild(t),this._contentLastChild===t&&(this._contentLastChild=null,setTimeout((()=>this._appendContent(this._selectedTextFieldID)),0));const i=t.id,s=this._contentNodeMap;s.get(i).dispose(),s.delete(i)}_appendContent(e){let t,i;const s=document.getElementById(e);if(s){s.classList.add(_.SUSPEND_POINTER_EVENTS),s.classList.add(h.TEXT_FIELD_SELECT);const e=s.parentElement.getAttribute(c.TYPE)===d.ROOT,n=s.clientHeight;t=e?0:s.parentElement.clientWidth-s.clientWidth,i=n*Array.from(s.parentElement.children).indexOf(s)+n/2}const n=this._data.getElementById(e),o=this._contentNodeMap;o.set(e,new b(n,t,i,this._isMobileDevice));const a=o.get(e);a.addListener(E.UPDATE_CONTENT,this._updateContentHandler),a.element.addEventListener(E.ANIMATION_END,this._appendContentAnimationEndHandler),m.CONTENT.appendChild(a.element),e!==d.ROOT?a.element.classList.add(h.CONTENT_NODE_APPEND):this._initLaunchAnimation()}_appendContentAnimationEndHandler(e){e.target.removeEventListener(E.ANIMATION_END,this._appendContentAnimationEndHandler),m.CONTENT.classList.remove(_.SUSPEND_POINTER_EVENTS)}_initLaunchAnimation(){const e=document.getElementById(l.PAGE_RIGHT);e.addEventListener(E.ANIMATION_END,this._bookPageRightAnimationEndHandler),e.classList.add(h.BOOK_PAGE_RIGHT),m.TITLE.classList.add(h.TITLE)}_bookPageRightAnimationEndHandler(e){e.target.removeEventListener(E.ANIMATION_END,this._bookPageRightAnimationEndHandler);document.getElementById(l.PAGE_LEFT).classList.add(h.BOOK_PAGE_LEFT);document.querySelector(`.${_.CONTENT_NODE_ROOT}`).classList.add(h.CONTENT_NODE_APPEND)}}).init()}]);