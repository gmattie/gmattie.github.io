!function(n){var i={};function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,n){n(2),e.exports=n(1)},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var o={CONTENT_MAP_URL:"./resources/build/data/contentMap.xml",LOUPE_URL:"./resources/build/images/Loupe.png"};Object.freeze(o);var s={WIDTH:76,HEIGHT:100,GAP:10,SCALE:.14,SKEW:.66};Object.freeze(s);var r={MARGIN:7,MINIMUM_STEM_WIDTH:16};Object.freeze(r);var a={GRAY_CHANNEL:"190",THEME:"#48BBEE"};Object.freeze(a);var d={AUTO:"auto",BOTTOM:"bottom",LEFT:"left",NONE:"none",MARGIN_TOP:"margin-top",MIN_HEIGHT:"min-height",MIN_WIDTH:"min-width",POSITION_ABSOLUTE:"absolute",POSITION_STATIC:"static",PX:"px",RIGHT:"right",SCALE:"scale",TRANSLATE:"translate"};Object.freeze(d);var h={BOOK_PAGE_LEFT:"animationBookPageLeft",BOOK_PAGE_RIGHT:"animationBookPageRight",CONTENT_NODE_APPEND:"animationContentNodeAppend",CONTENT_NODE_REMOVE:"animationContentNodeRemove",FADE_IN:"animationFadeIn",FADE_OUT:"animationFadeOut",IMAGE_PRELOADER:"animationImagePreloader",TEXT_FIELD_DESELECT:"animationTextFieldDeselect",TEXT_FIELD_SELECT:"animationTextFieldSelect",TITLE:"animationTitle"};Object.freeze(h);var _={CONTENT_NODE:"contentNode",CONTENT_NODE_LEAF:"contentNodeLeaf",CONTENT_NODE_ROOT:"contentNodeRoot",LOUPE:"loupe",PICTURE:"picture",SUSPEND_POINTER_EVENTS:"suspendPointerEvents",TEXT_FIELD_ACTIVE:"textFieldActive",TEXT_FIELD_FOOTNOTE:"textFieldFootnote",TEXT_FIELD_WHITESPACE:"textFieldWhitespace"};Object.freeze(_);var l={BACKGROUND:"background",BOOK:"book",BRACKET:"bracket",CONTENT:"content",MASK:"mask",OUTLINE:"outline",PAGE_LEFT:"pageLeft",PAGE_RIGHT:"pageRight",SKIN:"skin",ZOOM:"zoom"};Object.freeze(l);var c={ATTRIBUTE_DOWNLOAD:"download",ATTRIBUTE_FOOTNOTE:"footnote",ATTRIBUTE_HEIGHT:"height",ATTRIBUTE_HREF:"href",ATTRIBUTE_ID:"id",ATTRIBUTE_LABEL:"label",ATTRIBUTE_URL:"url",ATTRIBUTE_WIDTH:"width",ATTRIBUTE_ZOOMABLE:"zoomable",BRANCH:"branch",LEAF:"leaf",ROOT:"root"};Object.freeze(c);var u={ANIMATION_END:"animationend",CLICK:"click",CONTEXT_MENU:"contextmenu",DRAG_START:"dragstart",KEYDOWN:"keydown",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_MOVE:"mousemove",MOUSE_WHEEL:"wheel",RESIZE:"resize",UPDATE_CONTENT:"updateContent"};Object.freeze(u);var E={ANCHOR:"a",ANCHOR_TARGET_BLANK:"_blank",ANCHOR_TARGET_SELF:"_self",CANVAS_RENDERING_CONTEXT_2D:"2d",CANVAS:"canvas",DIV:"div",IMG:"img",TYPE:"type"};Object.freeze(E);var m={CONTENT:document.getElementById("content"),ICON:document.getElementById("icon"),MAIN:document.getElementsByTagName("main")[0],TITLE:document.getElementById("title")};Object.freeze(m);var f={ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",DOWN:"Down",LEFT:"Left",RIGHT:"Right",UP:"Up"};Object.freeze(f);var T={TRANSLATION:.5,WIDTH:1};Object.freeze(T);var v={ZOOM_DEFAULT:1,ZOOM_INSTRUCTION:"image zoom:  mouse over and scroll or press keyboard arrows.  hold shift to accelerate.",ZOOM_MAX:4,ZOOM_STEP:.01,ZOOM_STEP_ACCELERATED:.1};function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.freeze(v);var p=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this._scale=e,this._color=t,this._init()}var e,t,i;return e=n,(t=[{key:"_init",value:function(){this._element=document.createElement(E.DIV);var e=this._element;e.id=l.BOOK,e.style.lineHeight=0,this._draw()}},{key:"_draw",value:function(){this._leftPageCanvas=document.createElement(E.CANVAS);var e=this._leftPageCanvas;e.id=l.PAGE_LEFT,e.width=s.WIDTH*this._scale,e.height=s.HEIGHT*this._scale,e.style.transformOrigin="".concat(d.RIGHT," ").concat(d.BOTTOM);var t=e.getContext(E.CANVAS_RENDERING_CONTEXT_2D);t.fillStyle=this._color,t.transform(1,s.SKEW,0,1,0,0),t.fillRect(0,0,s.WIDTH*this._scale,s.HEIGHT/2*this._scale),t.fill(),this._rightPageCanvas=document.createElement(E.CANVAS);var n=this._rightPageCanvas;n.id=l.PAGE_RIGHT,n.width=s.WIDTH*this._scale,n.height=s.HEIGHT*this._scale,n.style.transformOrigin="".concat(d.LEFT," ").concat(d.BOTTOM);var i=n.getContext(E.CANVAS_RENDERING_CONTEXT_2D);for(i.fillStyle=this._color,i.transform(1,-s.SKEW,0,1,0,s.HEIGHT/2*this._scale),i.fillRect(s.GAP*this._scale,0,s.WIDTH*this._scale,s.HEIGHT/2*this._scale),i.fill();this._element.firstChild;)this._element.removeChild(this._element.firstChild);var o=this._element;o.appendChild(e),o.appendChild(n)}},{key:"dispose",value:function(){for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element=null,this._leftPageCanvas=null,this._rightPageCanvas=null}},{key:"element",get:function(){return this._element}},{key:"scale",set:function(e){this._scale=e,this._draw()},get:function(){return this._scale}},{key:"color",set:function(e){this._color=e,this._draw()},get:function(){return this._color}}])&&O(e.prototype,t),i&&O(e,i),n}(),N={a:void 0,b:void 0,c:void 0,d:void 0,tx:void 0,ty:void 0};function L(e){var t=window.getComputedStyle(e,null).getPropertyValue("transform");if(t){var n=Object.assign({},N),i=t.replace(/^.*\((.*)\)$/g,"$1").split(/, +/).map(Number);return Object.keys(n).forEach(function(e,t){n[e]=i[t]}),n}}function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.seal(N);var A=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this._stemWidth=e+r.MINIMUM_STEM_WIDTH,this._stemHeight=Math.floor(t)+r.MARGIN,this._init()}var e,t,i;return e=n,(t=[{key:"_init",value:function(){this._canvas=document.createElement(E.CANVAS);var e=this._canvas;e.id=l.BRACKET,e.width=this._stemWidth+r.MARGIN+Math.ceil(T.TRANSLATION),e.height=Math.max(window.screen.width,window.screen.height),e.style.top="-".concat(r.MARGIN).concat(d.PX),e.style.left="-".concat(e.width+r.MARGIN).concat(d.PX),this._context=e.getContext(E.CANVAS_RENDERING_CONTEXT_2D);var t=this._context;t.strokeStyle=a.THEME,t.lineWidth=T.WIDTH,t.translate(T.TRANSLATION,T.TRANSLATION)}},{key:"draw",value:function(e){var t=this._context,n=t.canvas.width-Math.ceil(T.TRANSLATION);t.clearRect(0,0,t.canvas.width,t.canvas.height),t.beginPath(),t.moveTo(n,0),t.lineTo(n-r.MARGIN,0),t.lineTo(n-r.MARGIN,e+2*r.MARGIN),t.lineTo(n,e+2*r.MARGIN),t.moveTo(0,this._stemHeight),t.lineTo(this._stemWidth,this._stemHeight),this._stemHeight>e&&t.lineTo(this._stemWidth,e+2*r.MARGIN),t.stroke()}},{key:"dispose",value:function(){this._canvas=null}},{key:"element",get:function(){return this._canvas}}])&&y(e.prototype,t),i&&y(e,i),n}();function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructor.name===e.name)throw new Error("Cannot instantiate abstract class.");this._listeners=new Map}var t,n,i;return t=e,(n=[{key:"addListener",value:function(e,t){this.hasListener(e)||this._listeners.set(e,[]),this._listeners.get(e).push(t)}},{key:"hasListener",value:function(e){return this._listeners.has(e)}},{key:"removeListener",value:function(e,t){if(this.hasListener(e)){var n=this._listeners.get(e);1<n.length?n.splice(n.indexOf(t),1):this._listeners.delete(e)}}},{key:"dispatch",value:function(e){if(this.hasListener(e)){for(var t=this._listeners.get(e),n=arguments.length,i=new Array(1<n?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var s=!0,r=!1,a=void 0;try{for(var l,h=t[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){l.value.apply(void 0,i)}}catch(e){r=!0,a=e}finally{try{s||null==h.return||h.return()}finally{if(r)throw a}}}}},{key:"dispose",value:function(){this._listeners=null}}])&&b(t.prototype,n),i&&b(t,i),e}();function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function C(e,t,n){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=H(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var D=function(e){function s(e,t){var n,i,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),i=this,(n=!(o=H(s).call(this))||"object"!==R(o)&&"function"!=typeof o?S(i):o)._url=e,n._XHRErrorHandler=n._XHRErrorHandler.bind(S(S(n))),n._XHRProgressHandler=n._XHRProgressHandler.bind(S(S(n))),n._XHRCompleteHandler=n._XHRCompleteHandler.bind(S(S(n))),n._xhr=new XMLHttpRequest,n._xhr.responseType=t,n}var t,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(s,g),t=s,i=[{key:"Event",get:function(){return{COMPLETE:"complete",ERROR:"error",PROGRESS:"progress"}}},{key:"ResponseType",get:function(){return{ARRAY_BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"}}}],(n=[{key:"_XHRErrorHandler",value:function(e){throw this._removeEventListeners(e.target),new Error("File Read Error")}},{key:"_XHRProgressHandler",value:function(e){C(H(s.prototype),"dispatch",this).call(this,s.Event.PROGRESS,{loaded:e.loaded,total:e.total})}},{key:"_XHRCompleteHandler",value:function(e){var t=e.target;if(this._removeEventListeners(t),404===t.status)throw new Error("File Not Found");C(H(s.prototype),"dispatch",this).call(this,s.Event.COMPLETE,{target:this,response:t.response})}},{key:"_removeEventListeners",value:function(e){e.removeEventListener(s.Event.ERROR,this._XHRErrorHandler),e.removeEventListener(s.Event.PROGRESS,this._XHRProgressHandler),e.removeEventListener("load",this._XHRCompleteHandler)}},{key:"load",value:function(){var e=this._xhr;e.addEventListener(s.Event.ERROR,this._XHRErrorHandler),e.addEventListener(s.Event.PROGRESS,this._XHRProgressHandler),e.addEventListener("load",this._XHRCompleteHandler),e.open("GET",this._url),e.send()}},{key:"abort",value:function(){this._removeEventListeners(this._xhr),this._xhr.abort()}},{key:"dispose",value:function(){this.abort(),C(H(s.prototype),"dispose",this).call(this),this._xhr=null}}])&&I(t.prototype,n),i&&I(t,i),s}();function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var P=function(){function h(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),this._init()}var e,t,n;return e=h,n=[{key:"ZoomDirection",get:function(){return{ZOOM_IN:1,ZOOM_OUT:-1}}}],(t=[{key:"_init",value:function(){this._background=document.createElement(E.DIV),this._background.id=l.BACKGROUND,this._content=document.createElement(E.IMG),this._content.id=l.CONTENT,this._mask=document.createElement(E.DIV),this._mask.id=l.MASK,this._mask.appendChild(this._content),this._skin=document.createElement(E.IMG),this._skin.id=l.SKIN,this._zoom=document.createElement(E.DIV),this._zoom.id=l.ZOOM,this._element=document.createElement(E.DIV);var e=this._element;e.classList.add(_.LOUPE),e.appendChild(this._background),e.appendChild(this._mask),e.appendChild(this._skin),e.appendChild(this._zoom),this._skinLoader=new D(o.LOUPE_URL,D.ResponseType.BLOB),this._skinLoader.addListener(D.Event.COMPLETE,this._skinLoaderCompleteHandler.bind(this)),this._skinLoader.load()}},{key:"_skinLoaderCompleteHandler",value:function(e){var t=URL.createObjectURL(e.response);this._skin.src=t,this._skinLoader.dispose(),this._skinLoader=null}},{key:"_restoreZoom",value:function(){var e=sessionStorage.getItem(l.ZOOM);this._zoomLevel=e?Math.max(this._minimumZoom,e):Math.max(this._minimumZoom,v.ZOOM_DEFAULT),this.updateZoom(),this._isZoomRestored=!0}},{key:"updateZoom",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,s=5<arguments.length&&void 0!==arguments[5]&&arguments[5];if(e){var r=s?v.ZOOM_STEP_ACCELERATED:v.ZOOM_STEP,a=-r,l=e===h.ZoomDirection.ZOOM_IN?r:a;this._zoomLevel=Math.min(Math.max(this._minimumZoom,this._zoomLevel+=l),v.ZOOM_MAX),this.updatePosition(t,n,i,o)}this._zoom.textContent=this._zoomLevel.toFixed(2)}},{key:"updatePosition",value:function(e,t,n,i){this._skinHalfSize||(this._skinHalfSize=this._skin.clientWidth/2),this._maskOffset||(this._maskOffset=L(this._mask));var o=e/n,s=t/i,r=-this._content.clientWidth*this._zoomLevel*o/this._zoomLevel-this._maskOffset.tx/this._zoomLevel+this._skinHalfSize/this._zoomLevel,a=-this._content.clientHeight*this._zoomLevel*s/this._zoomLevel-this._maskOffset.ty/this._zoomLevel+this._skinHalfSize/this._zoomLevel;this._element.style.transform="".concat(d.TRANSLATE,"(").concat(e-this._skinHalfSize).concat(d.PX,", ").concat(t-this._skinHalfSize).concat(d.PX,")"),this._content.style.transform="".concat(d.SCALE,"(").concat(this._zoomLevel,") ").concat(d.TRANSLATE,"(").concat(r).concat(d.PX,", ").concat(a).concat(d.PX,")")}},{key:"dispose",value:function(){try{sessionStorage.setItem(l.ZOOM,this._zoomLevel)}catch(e){console.error(e)}for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element=null,this._skinLoader&&(this._skinLoader.dispose(),this._skinLoader=null),this._skin&&(URL.revokeObjectURL(this._skin.src),this._skin=null),this._background=null,this._content=null,this._mask=null,this._zoom=null,this._maskOffset=null}},{key:"element",get:function(){return this._element}},{key:"content",set:function(e){this._content.src=e,this._minimumZoom&&this._restoreZoom()}},{key:"minimumZoom",set:function(e){this._minimumZoom=e,this._content.src&&!this._isZoomRestored?this._restoreZoom():this._zoomLevel<this._minimumZoom&&(this._zoomLevel=this._minimumZoom,this.updateZoom())}}])&&i(e.prototype,t),n&&i(e,n),h}();function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M=function(){function i(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this._nativeWidth=e,this._nativeHeight=t,this._grayChannel=n,this._init()}var e,t,n;return e=i,(t=[{key:"_init",value:function(){this._canvas=document.createElement(E.CANVAS);var e=this._canvas;e.id=l.MAGNIFIED_IMAGE_OUTLINE,e.width=this._nativeWidth+Math.ceil(T.TRANSLATION),e.height=this._nativeHeight+Math.ceil(T.TRANSLATION),this._context=e.getContext(E.CANVAS_RENDERING_CONTEXT_2D);var t=this._context;t.lineWidth=T.WIDTH,t.translate(T.TRANSLATION,T.TRANSLATION)}},{key:"draw",value:function(e,t){e=Math.min(e,this._nativeWidth)-T.WIDTH,t=Math.min(t,this._nativeHeight)-T.WIDTH;var n=this._context;n.clearRect(-T.TRANSLATION,-T.TRANSLATION,n.canvas.width,n.canvas.height),n.beginPath(),n.moveTo(0,0),n.lineTo(e,0),n.lineTo(e,t),n.lineTo(0,t),n.lineTo(0,0);var i=n.createLinearGradient(0,0,e,0);i.addColorStop("0","rgba(".concat(this._grayChannel,", ").concat(this._grayChannel,", ").concat(this._grayChannel,", 0)")),i.addColorStop("1","rgba(".concat(this._grayChannel,", ").concat(this._grayChannel,", ").concat(this._grayChannel,", 255)")),n.strokeStyle=i,n.stroke()}},{key:"dispose",value:function(){this._canvas=null}},{key:"element",get:function(){return this._canvas}}])&&w(e.prototype,t),n&&w(e,n),i}();function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var F=function(){function o(e,t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this._url=e,this._nativeWidth=t,this._nativeHeight=n,this._isZoomable=i,this._init()}var e,t,n;return e=o,(t=[{key:"_init",value:function(){this._element=document.createElement(E.DIV);var e=this._element;e.classList.add(_.PICTURE),e.style.lineHeight=0,this._isZoomable&&(this._loupe=new P,e.appendChild(this._loupe.element)),this._isLoading=!1,this._isLoaded=!1,this._fadeOutAnimationHandler=this._fadeOutAnimationHandler.bind(this),this._fadeInAnimationHandler=this._fadeInAnimationHandler.bind(this),this._outline=new M(this._nativeWidth,this._nativeHeight,a.GRAY_CHANNEL);var t=a.GRAY_CHANNEL,n="rgb(".concat(t,", ").concat(t,", ").concat(t,")");this._book=new p(s.SCALE,n),this._book.element.classList.add(h.IMAGE_PRELOADER),this._element.appendChild(this._outline.element),this._element.appendChild(this._book.element),this._contentLoader=new D(this._url,D.ResponseType.BLOB),this._contentLoader.addListener(D.Event.PROGRESS,this._contentLoaderProgressHandler.bind(this)),this._contentLoader.addListener(D.Event.COMPLETE,this._contentLoaderCompleteHandler.bind(this))}},{key:"_contentLoaderProgressHandler",value:function(e){var t=this._imageLoadProgressHeight/e.total*e.loaded;this._book.element.style.top="".concat(t).concat(d.PX)}},{key:"_contentLoaderCompleteHandler",value:function(e){var t=URL.createObjectURL(e.response);this._createContent(t),m.CONTENT.classList.add(_.SUSPEND_POINTER_EVENTS),this._element.addEventListener(u.ANIMATION_END,this._fadeOutAnimationHandler),this._element.classList.add(h.FADE_OUT),this._contentLoader.dispose(),this._contentLoader=null}},{key:"_createContent",value:function(e){this._isLoaded=!0,this._isLoading=!1,this._content=document.createElement(E.IMG);var t=this._content;t.id=l.CONTENT,t.src=e,this._contextMenuHandler=this._contextMenuHandler.bind(this),this._dragStartHandler=this._dragStartHandler.bind(this),t.addEventListener(u.CONTEXT_MENU,this._contextMenuHandler),t.addEventListener(u.DRAG_START,this._dragStartHandler),this._isZoomable&&(this._mouseEnterHandler=this._mouseEnterHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseLeaveHandler=this._mouseLeaveHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._keyDownHandler=this._keyDownHandler.bind(this),t.addEventListener(u.MOUSE_ENTER,this._mouseEnterHandler),t.addEventListener(u.MOUSE_MOVE,this._mouseMoveHandler),t.addEventListener(u.MOUSE_LEAVE,this._mouseLeaveHandler),t.addEventListener(u.MOUSE_WHEEL,this._mouseWheelHandler),this._loupe.content=e)}},{key:"_contextMenuHandler",value:function(e){e.preventDefault()}},{key:"_dragStartHandler",value:function(e){e.preventDefault()}},{key:"_mouseEnterHandler",value:function(){document.addEventListener(u.KEYDOWN,this._keyDownHandler),this._loupe.element.classList.remove(h.FADE_OUT),this._loupe.element.classList.add(h.FADE_IN),this._element.style.cursor=d.NONE}},{key:"_mouseMoveHandler",value:function(e){this._mouseX=e.clientX-this._imageOffsetX,this._mouseY=e.clientY-this._imageOffsetY,this._loupe.updatePosition(this._mouseX,this._mouseY,this._width,this._height)}},{key:"_mouseLeaveHandler",value:function(){document.removeEventListener(u.KEYDOWN,this._keyDownHandler),this._loupe.element.classList.remove(h.FADE_IN),this._loupe.element.classList.add(h.FADE_OUT),this._element.style.cursor=d.AUTO}},{key:"_mouseWheelHandler",value:function(e){e.target&&e.preventDefault();var t=e.deltaY<0?P.ZoomDirection.ZOOM_IN:P.ZoomDirection.ZOOM_OUT,n=e.shiftKey;this._loupe.updateZoom(t,this._mouseX,this._mouseY,this._width,this._height,n)}},{key:"_keyDownHandler",value:function(e){var t;switch(e.preventDefault(),e.key){case f.ARROW_UP:case f.UP:case f.ARROW_RIGHT:case f.RIGHT:t=P.ZoomDirection.ZOOM_IN;break;case f.ARROW_DOWN:case f.DOWN:case f.ARROW_LEFT:case f.LEFT:t=P.ZoomDirection.ZOOM_OUT;break;default:return}this._mouseWheelHandler({deltaY:-1*t,shiftKey:e.shiftKey})}},{key:"_fadeOutAnimationHandler",value:function(e){var t=e.target;t.removeEventListener(u.ANIMATION_END,this._fadeOutAnimationHandler),t.classList.remove(h.FADE_OUT),t.removeChild(this._outline.element),this._outline.dispose(),this._outline=null,t.removeChild(this._book.element),this._book.dispose(),this._book=null,t.appendChild(this._content),t.addEventListener(u.ANIMATION_END,this._fadeInAnimationHandler),t.classList.add(h.FADE_IN)}},{key:"_fadeInAnimationHandler",value:function(e){var t=e.target;t.removeEventListener(u.ANIMATION_END,this._fadeInAnimationHandler),t.classList.remove(h.FADE_IN),m.CONTENT.classList.remove(_.SUSPEND_POINTER_EVENTS)}},{key:"load",value:function(){this._isLoaded||(this._isLoading=!0,this._contentLoader.load())}},{key:"resize",value:function(e,t,n,i,o){var s,r=this._nativeWidth,a=this._nativeHeight;if(e<r||t<a){var l=e/r,h=t/a;s=Math.max(n/r,Math.min(l,h)),this._width=Math.floor(r*s),this._height=Math.floor(a*s)}else this._width=r,this._height=a,s=1;this._element.style.width="".concat(this._width).concat(d.PX),this._element.style.height="".concat(this._height).concat(d.PX),this._imageOffsetX=Math.round(i),this._imageOffsetY=Math.round(o),this._isZoomable&&(this._loupe.minimumZoom=s),this._isLoaded||(this._outline.draw(this._width,this._height),this._imageLoadProgressHeight=this._height-this._book.element.offsetHeight)}},{key:"dispose",value:function(){for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element.removeEventListener(u.ANIMATION_END,this._fadeOutAnimationHandler),this._element.removeEventListener(u.ANIMATION_END,this._fadeInAnimationHandler),this._element=null,this._contentLoader&&(this._contentLoader.dispose(),this._contentLoader=null),this._content&&(URL.revokeObjectURL(this._content.src),this._content.removeEventListener(u.CONTEXT_MENU,this._contextMenuHandler),this._content.removeEventListener(u.DRAG_START,this._dragStartHandler),this._isZoomable&&(this._content.removeEventListener(u.MOUSE_ENTER,this._mouseEnterHandler),this._content.removeEventListener(u.MOUSE_MOVE,this._mouseMoveHandler),this._content.removeEventListener(u.MOUSE_LEAVE,this._mouseLeaveHandler),this._content.removeEventListener(u.MOUSE_WHEEL,this._mouseWheelHandler),document.removeEventListener(u.KEYDOWN,this._keyDownHandler)),this._content=null),this._outline&&(this._outline.dispose(),this._outline=null),this._book&&(this._book.dispose(),this._book=null),this._loupe&&(this._loupe.dispose(),this._loupe=null)}},{key:"element",get:function(){return this._element}},{key:"isLoading",get:function(){return this._isLoading}},{key:"isLoaded",get:function(){return this._isLoaded}},{key:"isZoomable",get:function(){return this._isZoomable}}])&&U(e.prototype,t),n&&U(e,n),o}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function x(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function B(e,t,n){return(B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=j(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Z=function(e){function r(e,t,n,i,o){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(s=x(this,j(r).call(this)))._label=e,s._id=t,s._href=n,s._download=i,s._footnote=o,s._init(),s}var t,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(r,g),t=r,(n=[{key:"_init",value:function(){if(this._href){this._element=document.createElement(E.ANCHOR);var e=this._element;e.href=this._href,e.classList.add(_.TEXT_FIELD_ACTIVE),this._download?(e.target=E.ANCHOR_TARGET_SELF,e.download=""):e.target=E.ANCHOR_TARGET_BLANK}else{this._element=document.createElement(E.DIV);var t=this._element;this._id?(this._elementClickHandler=this._elementClickHandler.bind(this),t.id=this._id,t.classList.add(_.TEXT_FIELD_ACTIVE),t.addEventListener(u.CLICK,this._elementClickHandler)):this._footnote?t.classList.add(_.TEXT_FIELD_FOOTNOTE):/\S/.test(this._label)||t.classList.add(_.TEXT_FIELD_WHITESPACE)}this._element.textContent=this._label}},{key:"_elementClickHandler",value:function(){B(j(r.prototype),"dispatch",this).call(this,u.CLICK,this._id)}},{key:"dispose",value:function(){B(j(r.prototype),"dispose",this).call(this),this._element.removeEventListener(u.CLICK,this._elementClickHandler),this._element=null}},{key:"element",get:function(){return this._element}}])&&W(t.prototype,n),i&&W(t,i),r}();function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Y(e,t,n){return(Y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=q(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var J=function(e){function a(e,t,n,i){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(o=K(this,q(a).call(this)))._contentParentNode=e,o._bracketStemWidth=t,o._bracketStemHeight=n,o._isMobileDevice=i,o._init(),o}var t,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(a,g),t=a,(n=[{key:"_init",value:function(){if(!(this._contentParentNode instanceof Node&&this._contentParentNode.nodeType===Node.ELEMENT_NODE&&this._contentParentNode.hasChildNodes()))throw new Error("Invalid constructor argument.");var e=this._contentParentNode.nodeName;if(this._element=document.createElement(E.DIV),this._element.id=this._contentParentNode.id,this._element.setAttribute(E.TYPE,e),this._appendChildNodes(c.ATTRIBUTE_URL,this._createPicture.bind(this)),this._appendChildNodes(c.ATTRIBUTE_LABEL,this._createTextField.bind(this)),e===c.ROOT)this._element.classList.add(_.CONTENT_NODE_ROOT);else if(this._bracket=new A(this._bracketStemWidth,this._bracketStemHeight),this._element.appendChild(this._bracket.element),e===c.LEAF){if(this._element.classList.add(_.CONTENT_NODE_LEAF),this._createLeafMutationObserver(),this._picture){if(this._picture.isZoomable){var t=document.createElement(E.DIV);t.setAttribute(c.ATTRIBUTE_LABEL,v.ZOOM_INSTRUCTION),t.setAttribute(c.ATTRIBUTE_FOOTNOTE,c.ATTRIBUTE_FOOTNOTE),this._element.appendChild(this._createTextField(t).element)}this._element.insertBefore(this._bracket.element,this._picture.element)}}else this._element.classList.add(_.CONTENT_NODE),this._bracket.draw(this._elementClientRect().height)}},{key:"_appendChildNodes",value:function(e,t){var n=this._contentParentNode.childNodes,i=!0,o=!1,s=void 0;try{for(var r,a=n[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var l=r.value;if(l.nodeType===Node.ELEMENT_NODE&&l.getAttribute(e)){var h=t(l);this._element.appendChild(h.element)}}}catch(e){o=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}}},{key:"_createPicture",value:function(e){var t=e.getAttribute(c.ATTRIBUTE_URL),n=parseInt(e.getAttribute(c.ATTRIBUTE_WIDTH)),i=parseInt(e.getAttribute(c.ATTRIBUTE_HEIGHT)),o=e.getAttribute(c.ATTRIBUTE_ZOOMABLE)&&!this._isMobileDevice;return this._picture=new F(t,n,i,o),this._picture}},{key:"_createTextField",value:function(e){var t=this,n=e.getAttribute(c.ATTRIBUTE_LABEL),i=e.getAttribute(c.ATTRIBUTE_ID),o=e.getAttribute(c.ATTRIBUTE_HREF),s=e.getAttribute(c.ATTRIBUTE_DOWNLOAD),r=e.hasAttribute(c.ATTRIBUTE_FOOTNOTE);return this._textFields||(this._textFields=[]),this._textFields.unshift(new Z(n,i,o,s,r)),e.hasChildNodes()&&this._textFields[0].addListener(u.CLICK,function(e){return Y(q(a.prototype),"dispatch",t).call(t,u.UPDATE_CONTENT,e)}),this._textFields[0]}},{key:"_createLeafMutationObserver",value:function(){var i=this;this._contentParentNode.nodeName===c.LEAF&&(this._windowResizeHandler=this._windowResizeHandler.bind(this),this._containsTransformProperty=!0,this._mutationObserver=new MutationObserver(function(e){var t=i._picture;if(e[0].target.parentNode){if(i._containsTransformProperty){var n=L(i._element);i._updateLeafSize(n.tx,n.ty),i._containsTransformProperty=!1}window.addEventListener(u.RESIZE,i._windowResizeHandler),!t||t.isLoaded||t.isLoading||t.load()}else window.removeEventListener(u.RESIZE,i._windowResizeHandler),t&&t.dispose()}),this._mutationObserver.observe(this._element,{attributes:!0}))}},{key:"_elementClientRect",value:function(){var e,t=m.CONTENT;return t.contains(this._element)?e=this._element.getBoundingClientRect():(t.appendChild(this._element),e=this._element.getBoundingClientRect(),t.removeChild(this._element)),e}},{key:"_updateLeafSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};if(!this._previousViewPort||n.width!==this._previousViewPort.width||n.height!==this._previousViewPort.height){var i=this._elementClientRect(),o=parseFloat(window.getComputedStyle(m.MAIN,null).getPropertyValue(d.MARGIN_TOP)),s=n.width-i.left-o+e,r=this._picture;if(this._element.style.width="".concat(s).concat(d.PX),r){this._pictureMinWidth||(this._pictureMinWidth=parseFloat(window.getComputedStyle(r.element,null).getPropertyValue(d.MIN_WIDTH))),r.element.style.position=d.POSITION_ABSOLUTE;var a=this._elementClientRect().height,l=n.height-i.top-a-o+t;r.element.style.position=d.POSITION_STATIC;var h=i.left-e,_=i.top-t;r.resize(s,l,this._pictureMinWidth,h,_)}var c=this._elementClientRect().height;this._bracket.draw(c),this._previousViewPort={width:n.width,height:n.height}}}},{key:"_windowResizeHandler",value:function(){this._updateLeafSize()}},{key:"dispose",value:function(){for(Y(q(a.prototype),"dispose",this).call(this);this._element.firstChild;)this._element.removeChild(this._element.firstChild);if(this._element=null,this._picture&&(this._picture.dispose(),this._picture=null),this._textFields){var e=!0,t=!1,n=void 0;try{for(var i,o=this._textFields[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.dispose()}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this._textFields=null}this._bracket&&(this._bracket.dispose(),this._bracket=null),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null),window.removeEventListener(u.RESIZE,this._windowResizeHandler)}},{key:"element",get:function(){return this._element}}])&&V(t.prototype,n),i&&V(t,i),a}();function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"init",value:function(){this._isMobileDevice=window.navigator.userAgent.toLowerCase().includes("mobi"),this._isMobileDevice||document.addEventListener(u.KEYDOWN,function(e){switch(e.key){case f.ARROW_DOWN:case f.DOWN:case f.ARROW_LEFT:case f.LEFT:case f.ARROW_RIGHT:case f.RIGHT:case f.ARROW_UP:case f.UP:e.preventDefault()}}),this._contentNodeMap=new Map,this._dataLoaderCompleteHandler=this._dataLoaderCompleteHandler.bind(this),this._deselectAnimationEndHandler=this._deselectAnimationEndHandler.bind(this),this._removeAnimationEndHandler=this._removeAnimationEndHandler.bind(this),this._updateContentHandler=this._updateContentHandler.bind(this),this._appendContentAnimationEndHandler=this._appendContentAnimationEndHandler.bind(this),this._bookPageRightAnimationEndHandler=this._bookPageRightAnimationEndHandler.bind(this);var e=new D(o.CONTENT_MAP_URL,D.ResponseType.DOCUMENT);e.addListener(D.Event.COMPLETE,this._dataLoaderCompleteHandler),e.load()}},{key:"_dataLoaderCompleteHandler",value:function(e){e.target.removeListener(D.Event.COMPLETE,this._dataLoaderCompleteHandler),this._data=e.response;var t=new p(s.SCALE,a.THEME);m.ICON.appendChild(t.element),m.CONTENT.classList.add(_.SUSPEND_POINTER_EVENTS),this._appendContent(c.ROOT)}},{key:"_updateContentHandler",value:function(e){this._selectedTextFieldID=e,m.CONTENT.classList.add(_.SUSPEND_POINTER_EVENTS);var t=document.getElementById(this._selectedTextFieldID);t.classList.remove(_.TEXT_FIELD_ACTIVE);var n=t.parentNode;this._removeContent(n)}},{key:"_removeContent",value:function(e){if(e.getAttribute(E.TYPE)!==c.LEAF){var t=e.childNodes,n=!0,i=!1,o=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done);n=!0){var a=s.value;if(a.nodeType===Node.ELEMENT_NODE&&a.classList.contains(h.TEXT_FIELD_SELECT)){a.addEventListener(u.ANIMATION_END,this._deselectAnimationEndHandler),a.classList.remove(h.TEXT_FIELD_SELECT),a.classList.add(h.TEXT_FIELD_DESELECT);break}}}catch(e){i=!0,o=e}finally{try{n||null==r.return||r.return()}finally{if(i)throw o}}}if(!this._contentLastChild){var l=e.nextSibling;l&&l.nodeType===Node.ELEMENT_NODE?(l===m.CONTENT.lastChild&&(this._contentLastChild=l),l.addEventListener(u.ANIMATION_END,this._removeAnimationEndHandler),l.classList.remove(h.CONTENT_NODE_APPEND),l.classList.add(h.CONTENT_NODE_REMOVE),this._removeContent(l)):this._appendContent(this._selectedTextFieldID)}}},{key:"_deselectAnimationEndHandler",value:function(e){var t=e.target;t.removeEventListener(u.ANIMATION_END,this._deselectAnimationEndHandler),t.classList.remove(h.TEXT_FIELD_DESELECT),t.classList.remove(_.SUSPEND_POINTER_EVENTS),t.classList.add(_.TEXT_FIELD_ACTIVE)}},{key:"_removeAnimationEndHandler",value:function(e){var t=this,n=e.target;n.removeEventListener(u.ANIMATION_END,this._removeAnimationEndHandler),n.classList.remove(h.CONTENT_NODE_REMOVE),m.CONTENT.removeChild(n),this._contentLastChild===n&&(this._contentLastChild=null,setTimeout(function(){return t._appendContent(t._selectedTextFieldID)},0));var i=n.id,o=this._contentNodeMap;o.get(i).dispose(),o.delete(i)}},{key:"_appendContent",value:function(e){var t,n,i=document.getElementById(e);if(i){i.classList.add(_.SUSPEND_POINTER_EVENTS),i.classList.add(h.TEXT_FIELD_SELECT);var o=i.parentElement.getAttribute(E.TYPE)===c.ROOT,s=i.clientHeight;t=o?0:i.parentElement.clientWidth-i.clientWidth,n=s*Array.from(i.parentElement.children).indexOf(i)+s/2}var r=this._data.getElementById(e),a=this._contentNodeMap;a.set(e,new J(r,t,n,this._isMobileDevice));var l=a.get(e);l.addListener(u.UPDATE_CONTENT,this._updateContentHandler),l.element.addEventListener(u.ANIMATION_END,this._appendContentAnimationEndHandler),m.CONTENT.appendChild(l.element),e!==c.ROOT?l.element.classList.add(h.CONTENT_NODE_APPEND):this._initLaunchAnimation()}},{key:"_appendContentAnimationEndHandler",value:function(e){e.target.removeEventListener(u.ANIMATION_END,this._appendContentAnimationEndHandler),m.CONTENT.classList.remove(_.SUSPEND_POINTER_EVENTS)}},{key:"_initLaunchAnimation",value:function(){var e=document.getElementById(l.PAGE_RIGHT);e.addEventListener(u.ANIMATION_END,this._bookPageRightAnimationEndHandler),e.classList.add(h.BOOK_PAGE_RIGHT),m.TITLE.classList.add(h.TITLE)}},{key:"_bookPageRightAnimationEndHandler",value:function(e){e.target.removeEventListener(u.ANIMATION_END,this._bookPageRightAnimationEndHandler),document.getElementById(l.PAGE_LEFT).classList.add(h.BOOK_PAGE_LEFT),document.querySelector(".".concat(_.CONTENT_NODE_ROOT)).classList.add(h.CONTENT_NODE_APPEND)}}])&&Q(t.prototype,n),i&&Q(t,i),e}())).init()}]);